<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>GUIDE_COMPLET_PROJET</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5/github-markdown.min.css" />
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#guide-complet---système-de-gestion-des-tickets">Guide Complet - Système de Gestion des Tickets</a><ul>
<li><a href="#table-des-matières">Table des Matières</a></li>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#objectifs-du-projet">Objectifs du Projet</a></li>
<li><a href="#rôles-utilisateurs">Rôles Utilisateurs</a></li>
</ul></li>
<li><a href="#architecture-du-projet">Architecture du Projet</a><ul>
<li><a href="#architecture-générale">Architecture Générale</a></li>
<li><a href="#architecture-3-tiers">Architecture 3-Tiers</a></li>
</ul></li>
<li><a href="#technologies-utilisées">Technologies Utilisées</a><ul>
<li><a href="#backend">Backend</a></li>
<li><a href="#frontend">Frontend</a></li>
<li><a href="#base-de-données">Base de Données</a></li>
<li><a href="#outils-de-développement">Outils de Développement</a></li>
</ul></li>
<li><a href="#installation-et-configuration">Installation et Configuration</a><ul>
<li><a href="#prérequis">Prérequis</a></li>
<li><a href="#configuration-de-la-base-de-données">Configuration de la Base de Données</a></li>
</ul></li>
<li><a href="#structure-du-projet">Structure du Projet</a><ul>
<li><a href="#arborescence-complète">Arborescence Complète</a></li>
</ul></li>
<li><a href="#backend---spring-boot">Backend - Spring Boot</a><ul>
<li><a href="#configuration-application">Configuration Application</a></li>
<li><a href="#modèle-de-données-principal">Modèle de Données Principal</a></li>
<li><a href="#sécurité-jwt">Sécurité JWT</a></li>
<li><a href="#contrôleurs-rest">Contrôleurs REST</a></li>
<li><a href="#services-métier">Services Métier</a></li>
</ul></li>
<li><a href="#frontend---angular">Frontend - Angular</a><ul>
<li><a href="#configuration-du-projet">Configuration du Projet</a></li>
<li><a href="#services-angular">Services Angular</a></li>
<li><a href="#intercepteur-http---ajout-du-token-jwt">Intercepteur HTTP - Ajout du Token JWT</a></li>
<li><a href="#guards---protection-des-routes">Guards - Protection des Routes</a></li>
<li><a href="#configuration-des-routes">Configuration des Routes</a></li>
<li><a href="#composants-principaux">Composants Principaux</a></li>
</ul></li>
<li><a href="#base-de-données---postgresql">Base de Données - PostgreSQL</a><ul>
<li><a href="#schéma-complet">Schéma Complet</a></li>
<li><a href="#index-pour-performance">Index pour Performance</a></li>
</ul></li>
<li><a href="#fonctionnalités-principales">Fonctionnalités Principales</a><ul>
<li><a href="#création-de-ticket-citoyen">1. Création de Ticket (Citoyen)</a></li>
<li><a href="#assignation-de-ticket-admin">2. Assignation de Ticket (Admin)</a></li>
<li><a href="#suivi-de-ticket-citoyen">3. Suivi de Ticket (Citoyen)</a></li>
<li><a href="#traitement-de-ticket-agent">4. Traitement de Ticket (Agent)</a></li>
<li><a href="#gestion-des-utilisateurs-admin">5. Gestion des Utilisateurs (Admin)</a></li>
</ul></li>
<li><a href="#sécurité-et-authentification">Sécurité et Authentification</a><ul>
<li><a href="#authentification-jwt">Authentification JWT</a></li>
<li><a href="#hachage-des-mots-de-passe">Hachage des Mots de Passe</a></li>
<li><a href="#protection-csrf-et-cors">Protection CSRF et CORS</a></li>
<li><a href="#autorisation-basée-sur-les-rôles">Autorisation basée sur les Rôles</a></li>
</ul></li>
<li><a href="#tests-et-documentation-api">Tests et Documentation API</a><ul>
<li><a href="#swaggeropenapi">Swagger/OpenAPI</a></li>
<li><a href="#tests-manuels-avec-postman">Tests Manuels avec Postman</a></li>
</ul></li>
<li><a href="#gestion-des-backups">Gestion des Backups</a><ul>
<li><a href="#scripts-de-backup-automatique">Scripts de Backup Automatique</a></li>
<li><a href="#utilisation-des-backups">Utilisation des Backups</a></li>
</ul></li>
<li><a href="#déploiement">Déploiement</a><ul>
<li><a href="#compilation-et-build">Compilation et Build</a></li>
<li><a href="#démarrage-de-lapplication">Démarrage de l’Application</a></li>
<li><a href="#vérification-du-déploiement">Vérification du Déploiement</a></li>
<li><a href="#variables-denvironnement">Variables d’Environnement</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#problèmes-courants">Problèmes Courants</a></li>
<li><a href="#logs-et-débogage">Logs et Débogage</a></li>
<li><a href="#commandes-utiles">Commandes Utiles</a></li>
</ul></li>
<li><a href="#comptes-de-test">Comptes de Test</a><ul>
<li><a href="#utilisateurs-préconfigurés">Utilisateurs Préconfigurés</a></li>
</ul></li>
<li><a href="#ressources-et-documentation">Ressources et Documentation</a><ul>
<li><a href="#documentation-officielle">Documentation Officielle</a></li>
<li><a href="#outils-utilisés">Outils Utilisés</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a><ul>
<li><a href="#points-clés-à-retenir">Points Clés à Retenir</a></li>
<li><a href="#prochaines-étapes">Prochaines Étapes</a></li>
<li><a href="#support">Support</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="guide-complet---système-de-gestion-des-tickets">Guide Complet - Système de Gestion des Tickets</h1>
<h2 id="table-des-matières">Table des Matières</h2>
<ol type="1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#architecture-du-projet">Architecture du Projet</a></li>
<li><a href="#technologies-utilisées">Technologies Utilisées</a></li>
<li><a href="#installation-et-configuration">Installation et Configuration</a></li>
<li><a href="#structure-du-projet">Structure du Projet</a></li>
<li><a href="#backend---spring-boot">Backend - Spring Boot</a></li>
<li><a href="#frontend---angular">Frontend - Angular</a></li>
<li><a href="#base-de-données---postgresql">Base de Données - PostgreSQL</a></li>
<li><a href="#fonctionnalités-principales">Fonctionnalités Principales</a></li>
<li><a href="#sécurité-et-authentification">Sécurité et Authentification</a></li>
<li><a href="#tests-et-documentation-api">Tests et Documentation API</a></li>
<li><a href="#gestion-des-backups">Gestion des Backups</a></li>
<li><a href="#déploiement">Déploiement</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 id="introduction">Introduction</h2>
<p>Ce guide présente le développement complet d’un <strong>Système de Gestion des Tickets</strong> pour le Ministère de la Justice. Le système permet aux citoyens de soumettre des tickets, et aux agents de les traiter selon leur rôle.</p>
<h3 id="objectifs-du-projet">Objectifs du Projet</h3>
<ul>
<li>Permettre aux citoyens de créer et suivre des tickets</li>
<li>Gérer les tickets par des agents de support et de traitement</li>
<li>Administrer le système via des comptes administrateurs</li>
<li>Assurer la sécurité des données avec authentification JWT</li>
<li>Fournir un suivi complet avec historique et notifications</li>
</ul>
<h3 id="rôles-utilisateurs">Rôles Utilisateurs</h3>
<ol type="1">
<li><strong>ROLE_CITOYEN</strong> : Créer et consulter ses propres tickets</li>
<li><strong>ROLE_AGENT_SUPPORT</strong> : Assigner et traiter les tickets</li>
<li><strong>ROLE_AGENT_TRAITEMENT</strong> : Traiter les tickets assignés</li>
<li><strong>ROLE_ADMIN_SUPPORT</strong> : Administrer le système et gérer les utilisateurs</li>
</ol>
<hr />
<h2 id="architecture-du-projet">Architecture du Projet</h2>
<h3 id="architecture-générale">Architecture Générale</h3>
<pre><code>┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│                 │         │                 │         │                 │
│   Angular 17    │ ◄─────► │  Spring Boot    │ ◄─────► │  PostgreSQL 12  │
│   (Frontend)    │  HTTP   │   (Backend)     │  JDBC   │   (Database)    │
│   Port 4200     │   REST  │   Port 8080     │         │   Port 5432     │
│                 │         │                 │         │                 │
└─────────────────┘         └─────────────────┘         └─────────────────┘</code></pre>
<h3 id="architecture-3-tiers">Architecture 3-Tiers</h3>
<ol type="1">
<li><strong>Couche Présentation</strong> : Angular (Interface utilisateur)</li>
<li><strong>Couche Métier</strong> : Spring Boot (Logique applicative)</li>
<li><strong>Couche Données</strong> : PostgreSQL (Persistance)</li>
</ol>
<hr />
<h2 id="technologies-utilisées">Technologies Utilisées</h2>
<h3 id="backend">Backend</h3>
<table>
<thead>
<tr class="header">
<th>Technologie</th>
<th>Version</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Java</td>
<td>21</td>
<td>Langage de programmation</td>
</tr>
<tr class="even">
<td>Spring Boot</td>
<td>3.3.6</td>
<td>Framework backend</td>
</tr>
<tr class="odd">
<td>Spring Security</td>
<td>3.3.6</td>
<td>Authentification et autorisation</td>
</tr>
<tr class="even">
<td>Spring Data JPA</td>
<td>3.3.6</td>
<td>ORM et accès aux données</td>
</tr>
<tr class="odd">
<td>PostgreSQL Driver</td>
<td>Runtime</td>
<td>Connexion base de données</td>
</tr>
<tr class="even">
<td>JWT (jsonwebtoken)</td>
<td>0.11.5</td>
<td>Tokens d’authentification</td>
</tr>
<tr class="odd">
<td>Lombok</td>
<td>Latest</td>
<td>Réduction du code boilerplate</td>
</tr>
<tr class="even">
<td>SpringDoc OpenAPI</td>
<td>2.3.0</td>
<td>Documentation API (Swagger)</td>
</tr>
<tr class="odd">
<td>Maven</td>
<td>3.x</td>
<td>Gestionnaire de dépendances</td>
</tr>
</tbody>
</table>
<h3 id="frontend">Frontend</h3>
<table>
<thead>
<tr class="header">
<th>Technologie</th>
<th>Version</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Angular</td>
<td>17</td>
<td>Framework frontend</td>
</tr>
<tr class="even">
<td>TypeScript</td>
<td>5.x</td>
<td>Langage de programmation</td>
</tr>
<tr class="odd">
<td>RxJS</td>
<td>Latest</td>
<td>Programmation réactive</td>
</tr>
<tr class="even">
<td>Angular Router</td>
<td>17</td>
<td>Navigation</td>
</tr>
<tr class="odd">
<td>HttpClient</td>
<td>17</td>
<td>Appels API</td>
</tr>
</tbody>
</table>
<h3 id="base-de-données">Base de Données</h3>
<table>
<thead>
<tr class="header">
<th>Technologie</th>
<th>Version</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PostgreSQL</td>
<td>12.22</td>
<td>Système de gestion de base de données</td>
</tr>
</tbody>
</table>
<h3 id="outils-de-développement">Outils de Développement</h3>
<ul>
<li><strong>IDE</strong> : Visual Studio Code / IntelliJ IDEA</li>
<li><strong>Contrôle de version</strong> : Git / GitHub</li>
<li><strong>Test API</strong> : Swagger UI / Postman</li>
<li><strong>Gestion BDD</strong> : DBeaver Community Edition</li>
<li><strong>Build</strong> : Maven pour backend, npm pour frontend</li>
</ul>
<hr />
<h2 id="installation-et-configuration">Installation et Configuration</h2>
<h3 id="prérequis">Prérequis</h3>
<h4 id="installer-java-21">1. Installer Java 21</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Vérifier la version de Java</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ex">java</span> -version</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># Si Java n&#39;est pas installé</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="fu">sudo</span> apt update</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="fu">sudo</span> apt install openjdk-21-jdk</a></code></pre></div>
<h4 id="installer-postgresql">2. Installer PostgreSQL</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Installer PostgreSQL</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="fu">sudo</span> apt update</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="fu">sudo</span> apt install postgresql postgresql-contrib</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># Démarrer le service</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="fu">sudo</span> systemctl start postgresql</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="fu">sudo</span> systemctl enable postgresql</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># Vérifier le statut</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="fu">sudo</span> systemctl status postgresql</a></code></pre></div>
<h4 id="installer-node.js-et-npm">3. Installer Node.js et npm</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Installer Node.js (version 18 ou supérieure)</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ex">curl</span> -fsSL https://deb.nodesource.com/setup_18.x <span class="kw">|</span> <span class="fu">sudo</span> -E bash -</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="fu">sudo</span> apt install -y nodejs</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"># Vérifier les versions</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="ex">node</span> --version</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="ex">npm</span> --version</a></code></pre></div>
<h4 id="installer-angular-cli">4. Installer Angular CLI</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">sudo</span> npm install -g @angular/cli@17</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="ex">ng</span> version</a></code></pre></div>
<h4 id="installer-maven">5. Installer Maven</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">sudo</span> apt install maven</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ex">mvn</span> -version</a></code></pre></div>
<h3 id="configuration-de-la-base-de-données">Configuration de la Base de Données</h3>
<h4 id="créer-lutilisateur-et-la-base-de-données">1. Créer l’utilisateur et la base de données</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Se connecter à PostgreSQL</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="fu">sudo</span> -u postgres psql</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co"># Dans le shell PostgreSQL</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="ex">CREATE</span> USER postgres WITH PASSWORD <span class="st">&#39;postgres&#39;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="ex">CREATE</span> DATABASE ticketing_db OWNER postgres<span class="kw">;</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="ex">GRANT</span> ALL PRIVILEGES ON DATABASE ticketing_db TO postgres<span class="kw">;</span></a>
<a class="sourceLine" id="cb7-8" title="8">\<span class="ex">q</span></a></code></pre></div>
<h4 id="initialiser-le-schéma">2. Initialiser le schéma</h4>
<p>Le fichier <code>database/init.sql</code> contient le schéma complet :</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" title="1"><span class="co">-- Tables principales</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">roles</span> (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">CREATE</span> <span class="kw">TABLE</span> user_roles (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">CREATE</span> <span class="kw">TABLE</span> tickets (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">CREATE</span> <span class="kw">TABLE</span> commentaires (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw">CREATE</span> <span class="kw">TABLE</span> notifications (<span class="op">..</span>.)</a>
<a class="sourceLine" id="cb8-8" title="8"><span class="kw">CREATE</span> <span class="kw">TABLE</span> ticket_historique (<span class="op">..</span>.)</a></code></pre></div>
<p>Exécuter le script :</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">psql</span> -U postgres -h localhost -d ticketing_db -f ticketing-backend/database/init.sql</a></code></pre></div>
<hr />
<h2 id="structure-du-projet">Structure du Projet</h2>
<h3 id="arborescence-complète">Arborescence Complète</h3>
<pre><code>TICKETING-PROJECT/
│
├── ticketing-backend/              # Backend Spring Boot
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/justice/ticketing/
│   │   │   │   ├── TicketingApplication.java
│   │   │   │   ├── config/
│   │   │   │   │   ├── DataInitializer.java
│   │   │   │   │   ├── SecurityConfig.java
│   │   │   │   │   └── OpenApiConfig.java
│   │   │   │   ├── controller/
│   │   │   │   │   ├── AuthController.java
│   │   │   │   │   ├── TicketController.java
│   │   │   │   │   ├── AdminController.java
│   │   │   │   │   └── NotificationController.java
│   │   │   │   ├── dto/
│   │   │   │   │   ├── LoginRequest.java
│   │   │   │   │   ├── SignupRequest.java
│   │   │   │   │   ├── JwtResponse.java
│   │   │   │   │   ├── TicketRequest.java
│   │   │   │   │   └── TicketResponse.java
│   │   │   │   ├── model/
│   │   │   │   │   ├── User.java
│   │   │   │   │   ├── Role.java
│   │   │   │   │   ├── Ticket.java
│   │   │   │   │   ├── Commentaire.java
│   │   │   │   │   ├── Notification.java
│   │   │   │   │   └── TicketHistorique.java
│   │   │   │   ├── repository/
│   │   │   │   │   ├── UserRepository.java
│   │   │   │   │   ├── RoleRepository.java
│   │   │   │   │   ├── TicketRepository.java
│   │   │   │   │   ├── CommentaireRepository.java
│   │   │   │   │   ├── NotificationRepository.java
│   │   │   │   │   └── TicketHistoriqueRepository.java
│   │   │   │   ├── security/
│   │   │   │   │   ├── JwtUtils.java
│   │   │   │   │   ├── AuthTokenFilter.java
│   │   │   │   │   ├── AuthEntryPointJwt.java
│   │   │   │   │   ├── UserDetailsImpl.java
│   │   │   │   │   └── UserDetailsServiceImpl.java
│   │   │   │   └── service/
│   │   │   │       ├── TicketService.java
│   │   │   │       └── NotificationService.java
│   │   │   └── resources/
│   │   │       ├── application.properties
│   │   │       ├── application-dev.properties
│   │   │       └── application-prod.properties
│   ├── database/
│   │   ├── init.sql
│   │   └── README.md
│   ├── pom.xml
│   └── API_TESTS.http
│
├── ticketing-frontend/             # Frontend Angular
│   ├── src/
│   │   ├── app/
│   │   │   ├── components/
│   │   │   │   ├── login/
│   │   │   │   ├── dashboard/
│   │   │   │   └── admin-ticket-management/
│   │   │   ├── services/
│   │   │   │   └── auth.service.ts
│   │   │   ├── app.component.ts
│   │   │   └── app.routes.ts
│   │   ├── index.html
│   │   ├── main.ts
│   │   └── styles.css
│   ├── angular.json
│   ├── package.json
│   ├── tsconfig.json
│   └── proxy.conf.json
│
├── backups/                        # Backups base de données
│   ├── backup.sh
│   ├── restore.sh
│   └── README.md
│
└── README.md</code></pre>
<hr />
<h2 id="backend---spring-boot">Backend - Spring Boot</h2>
<h3 id="configuration-application">Configuration Application</h3>
<p><strong>application.properties</strong></p>
<pre class="properties"><code>spring.application.name=ticketing-system

# Profile actif
spring.profiles.active=dev

# Configuration JWT
app.jwt.secret=YourBase64EncodedSecretKeyHere
app.jwt.expiration=86400000

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Configuration serveur
server.port=8080</code></pre>
<p><strong>application-dev.properties</strong></p>
<pre class="properties"><code># Database PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/ticketing_db
spring.datasource.username=postgres
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Logging
logging.level.com.justice.ticketing=DEBUG
logging.level.org.springframework.security=DEBUG</code></pre>
<h3 id="modèle-de-données-principal">Modèle de Données Principal</h3>
<h4 id="entité-user">Entité User</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb13-1" title="1"><span class="at">@Entity</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="at">@Table</span>(name = <span class="st">&quot;users&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="at">@Data</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="at">@NoArgsConstructor</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="at">@AllArgsConstructor</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw">public</span> <span class="kw">class</span> User {</a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="at">@Id</span></a>
<a class="sourceLine" id="cb13-8" title="8">    <span class="at">@GeneratedValue</span>(strategy = GenerationType.<span class="fu">IDENTITY</span>)</a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="kw">private</span> <span class="bu">Long</span> id;</a>
<a class="sourceLine" id="cb13-10" title="10">    </a>
<a class="sourceLine" id="cb13-11" title="11">    <span class="at">@Column</span>(unique = <span class="kw">true</span>, nullable = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb13-12" title="12">    <span class="kw">private</span> <span class="bu">String</span> email;</a>
<a class="sourceLine" id="cb13-13" title="13">    </a>
<a class="sourceLine" id="cb13-14" title="14">    <span class="at">@Column</span>(nullable = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="kw">private</span> <span class="bu">String</span> password;</a>
<a class="sourceLine" id="cb13-16" title="16">    </a>
<a class="sourceLine" id="cb13-17" title="17">    <span class="kw">private</span> <span class="bu">String</span> nom;</a>
<a class="sourceLine" id="cb13-18" title="18">    <span class="kw">private</span> <span class="bu">String</span> prenom;</a>
<a class="sourceLine" id="cb13-19" title="19">    <span class="kw">private</span> <span class="bu">String</span> telephone;</a>
<a class="sourceLine" id="cb13-20" title="20">    </a>
<a class="sourceLine" id="cb13-21" title="21">    <span class="at">@ManyToMany</span>(fetch = FetchType.<span class="fu">EAGER</span>)</a>
<a class="sourceLine" id="cb13-22" title="22">    <span class="at">@JoinTable</span>(</a>
<a class="sourceLine" id="cb13-23" title="23">        name = <span class="st">&quot;user_roles&quot;</span>,</a>
<a class="sourceLine" id="cb13-24" title="24">        joinColumns = <span class="at">@JoinColumn</span>(name = <span class="st">&quot;user_id&quot;</span>),</a>
<a class="sourceLine" id="cb13-25" title="25">        inverseJoinColumns = <span class="at">@JoinColumn</span>(name = <span class="st">&quot;role_id&quot;</span>)</a>
<a class="sourceLine" id="cb13-26" title="26">    )</a>
<a class="sourceLine" id="cb13-27" title="27">    <span class="kw">private</span> <span class="bu">Set</span>&lt;<span class="bu">Role</span>&gt; roles = <span class="kw">new</span> <span class="bu">HashSet</span>&lt;&gt;();</a>
<a class="sourceLine" id="cb13-28" title="28">    </a>
<a class="sourceLine" id="cb13-29" title="29">    <span class="kw">private</span> LocalDateTime dateCreation;</a>
<a class="sourceLine" id="cb13-30" title="30">    <span class="kw">private</span> <span class="bu">Boolean</span> actif = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb13-31" title="31">}</a></code></pre></div>
<h4 id="entité-ticket">Entité Ticket</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb14-1" title="1"><span class="at">@Entity</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="at">@Table</span>(name = <span class="st">&quot;tickets&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="at">@Data</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="at">@NoArgsConstructor</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="at">@AllArgsConstructor</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="kw">public</span> <span class="kw">class</span> Ticket {</a>
<a class="sourceLine" id="cb14-7" title="7">    <span class="at">@Id</span></a>
<a class="sourceLine" id="cb14-8" title="8">    <span class="at">@GeneratedValue</span>(strategy = GenerationType.<span class="fu">IDENTITY</span>)</a>
<a class="sourceLine" id="cb14-9" title="9">    <span class="kw">private</span> <span class="bu">Long</span> id;</a>
<a class="sourceLine" id="cb14-10" title="10">    </a>
<a class="sourceLine" id="cb14-11" title="11">    <span class="at">@Column</span>(unique = <span class="kw">true</span>, nullable = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb14-12" title="12">    <span class="kw">private</span> <span class="bu">String</span> numeroTicket;</a>
<a class="sourceLine" id="cb14-13" title="13">    </a>
<a class="sourceLine" id="cb14-14" title="14">    <span class="at">@Column</span>(nullable = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb14-15" title="15">    <span class="kw">private</span> <span class="bu">String</span> sujet;</a>
<a class="sourceLine" id="cb14-16" title="16">    </a>
<a class="sourceLine" id="cb14-17" title="17">    <span class="at">@Column</span>(columnDefinition = <span class="st">&quot;TEXT&quot;</span>)</a>
<a class="sourceLine" id="cb14-18" title="18">    <span class="kw">private</span> <span class="bu">String</span> description;</a>
<a class="sourceLine" id="cb14-19" title="19">    </a>
<a class="sourceLine" id="cb14-20" title="20">    <span class="at">@Enumerated</span>(EnumType.<span class="fu">STRING</span>)</a>
<a class="sourceLine" id="cb14-21" title="21">    <span class="kw">private</span> StatutTicket statut = StatutTicket.<span class="fu">OUVERT</span>;</a>
<a class="sourceLine" id="cb14-22" title="22">    </a>
<a class="sourceLine" id="cb14-23" title="23">    <span class="at">@Enumerated</span>(EnumType.<span class="fu">STRING</span>)</a>
<a class="sourceLine" id="cb14-24" title="24">    <span class="kw">private</span> PrioriteTicket priorite = PrioriteTicket.<span class="fu">MOYENNE</span>;</a>
<a class="sourceLine" id="cb14-25" title="25">    </a>
<a class="sourceLine" id="cb14-26" title="26">    <span class="at">@ManyToOne</span></a>
<a class="sourceLine" id="cb14-27" title="27">    <span class="at">@JoinColumn</span>(name = <span class="st">&quot;createur_id&quot;</span>)</a>
<a class="sourceLine" id="cb14-28" title="28">    <span class="kw">private</span> User createur;</a>
<a class="sourceLine" id="cb14-29" title="29">    </a>
<a class="sourceLine" id="cb14-30" title="30">    <span class="at">@ManyToOne</span></a>
<a class="sourceLine" id="cb14-31" title="31">    <span class="at">@JoinColumn</span>(name = <span class="st">&quot;assigne_a_id&quot;</span>)</a>
<a class="sourceLine" id="cb14-32" title="32">    <span class="kw">private</span> User assigneA;</a>
<a class="sourceLine" id="cb14-33" title="33">    </a>
<a class="sourceLine" id="cb14-34" title="34">    <span class="kw">private</span> LocalDateTime dateCreation;</a>
<a class="sourceLine" id="cb14-35" title="35">    <span class="kw">private</span> LocalDateTime dateModification;</a>
<a class="sourceLine" id="cb14-36" title="36">    <span class="kw">private</span> LocalDateTime dateCloture;</a>
<a class="sourceLine" id="cb14-37" title="37">}</a></code></pre></div>
<h3 id="sécurité-jwt">Sécurité JWT</h3>
<h4 id="configuration-de-sécurité">Configuration de Sécurité</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb15-1" title="1"><span class="at">@Configuration</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="at">@EnableWebSecurity</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="at">@EnableMethodSecurity</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">public</span> <span class="kw">class</span> SecurityConfig {</a>
<a class="sourceLine" id="cb15-5" title="5">    </a>
<a class="sourceLine" id="cb15-6" title="6">    <span class="at">@Bean</span></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="kw">public</span> SecurityFilterChain <span class="fu">filterChain</span>(HttpSecurity http) <span class="kw">throws</span> <span class="bu">Exception</span> {</a>
<a class="sourceLine" id="cb15-8" title="8">        http.<span class="fu">csrf</span>(csrf -&gt; csrf.<span class="fu">disable</span>())</a>
<a class="sourceLine" id="cb15-9" title="9">            .<span class="fu">exceptionHandling</span>(exception -&gt; exception</a>
<a class="sourceLine" id="cb15-10" title="10">                .<span class="fu">authenticationEntryPoint</span>(unauthorizedHandler))</a>
<a class="sourceLine" id="cb15-11" title="11">            .<span class="fu">sessionManagement</span>(session -&gt; session</a>
<a class="sourceLine" id="cb15-12" title="12">                .<span class="fu">sessionCreationPolicy</span>(SessionCreationPolicy.<span class="fu">STATELESS</span>))</a>
<a class="sourceLine" id="cb15-13" title="13">            .<span class="fu">authorizeHttpRequests</span>(auth -&gt; auth</a>
<a class="sourceLine" id="cb15-14" title="14">                .<span class="fu">requestMatchers</span>(<span class="st">&quot;/api/auth/**&quot;</span>).<span class="fu">permitAll</span>()</a>
<a class="sourceLine" id="cb15-15" title="15">                .<span class="fu">requestMatchers</span>(<span class="st">&quot;/api/admin/**&quot;</span>).<span class="fu">hasRole</span>(<span class="st">&quot;ADMIN_SUPPORT&quot;</span>)</a>
<a class="sourceLine" id="cb15-16" title="16">                .<span class="fu">requestMatchers</span>(<span class="st">&quot;/v3/api-docs/**&quot;</span>, <span class="st">&quot;/swagger-ui/**&quot;</span>).<span class="fu">permitAll</span>()</a>
<a class="sourceLine" id="cb15-17" title="17">                .<span class="fu">anyRequest</span>().<span class="fu">authenticated</span>()</a>
<a class="sourceLine" id="cb15-18" title="18">            );</a>
<a class="sourceLine" id="cb15-19" title="19">        </a>
<a class="sourceLine" id="cb15-20" title="20">        http.<span class="fu">addFilterBefore</span>(authTokenFilter, </a>
<a class="sourceLine" id="cb15-21" title="21">                            UsernamePasswordAuthenticationFilter.<span class="fu">class</span>);</a>
<a class="sourceLine" id="cb15-22" title="22">        </a>
<a class="sourceLine" id="cb15-23" title="23">        <span class="kw">return</span> http.<span class="fu">build</span>();</a>
<a class="sourceLine" id="cb15-24" title="24">    }</a>
<a class="sourceLine" id="cb15-25" title="25">}</a></code></pre></div>
<h4 id="génération-et-validation-jwt">Génération et Validation JWT</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb16-1" title="1"><span class="at">@Component</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">public</span> <span class="kw">class</span> JwtUtils {</a>
<a class="sourceLine" id="cb16-3" title="3">    </a>
<a class="sourceLine" id="cb16-4" title="4">    <span class="at">@Value</span>(<span class="st">&quot;${app.jwt.secret}&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" title="5">    <span class="kw">private</span> <span class="bu">String</span> jwtSecret;</a>
<a class="sourceLine" id="cb16-6" title="6">    </a>
<a class="sourceLine" id="cb16-7" title="7">    <span class="at">@Value</span>(<span class="st">&quot;${app.jwt.expiration}&quot;</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">    <span class="kw">private</span> <span class="dt">int</span> jwtExpirationMs;</a>
<a class="sourceLine" id="cb16-9" title="9">    </a>
<a class="sourceLine" id="cb16-10" title="10">    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">generateJwtToken</span>(Authentication authentication) {</a>
<a class="sourceLine" id="cb16-11" title="11">        UserDetailsImpl userPrincipal = (UserDetailsImpl) authentication.<span class="fu">getPrincipal</span>();</a>
<a class="sourceLine" id="cb16-12" title="12">        </a>
<a class="sourceLine" id="cb16-13" title="13">        <span class="kw">return</span> Jwts.<span class="fu">builder</span>()</a>
<a class="sourceLine" id="cb16-14" title="14">            .<span class="fu">setSubject</span>(userPrincipal.<span class="fu">getUsername</span>())</a>
<a class="sourceLine" id="cb16-15" title="15">            .<span class="fu">setIssuedAt</span>(<span class="kw">new</span> <span class="bu">Date</span>())</a>
<a class="sourceLine" id="cb16-16" title="16">            .<span class="fu">setExpiration</span>(<span class="kw">new</span> <span class="bu">Date</span>((<span class="kw">new</span> <span class="bu">Date</span>()).<span class="fu">getTime</span>() + jwtExpirationMs))</a>
<a class="sourceLine" id="cb16-17" title="17">            .<span class="fu">signWith</span>(<span class="fu">key</span>(), SignatureAlgorithm.<span class="fu">HS512</span>)</a>
<a class="sourceLine" id="cb16-18" title="18">            .<span class="fu">compact</span>();</a>
<a class="sourceLine" id="cb16-19" title="19">    }</a>
<a class="sourceLine" id="cb16-20" title="20">    </a>
<a class="sourceLine" id="cb16-21" title="21">    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">validateJwtToken</span>(<span class="bu">String</span> authToken) {</a>
<a class="sourceLine" id="cb16-22" title="22">        <span class="kw">try</span> {</a>
<a class="sourceLine" id="cb16-23" title="23">            Jwts.<span class="fu">parserBuilder</span>().<span class="fu">setSigningKey</span>(<span class="fu">key</span>()).<span class="fu">build</span>().<span class="fu">parse</span>(authToken);</a>
<a class="sourceLine" id="cb16-24" title="24">            <span class="kw">return</span> <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb16-25" title="25">        } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {</a>
<a class="sourceLine" id="cb16-26" title="26">            logger.<span class="fu">error</span>(<span class="st">&quot;Invalid JWT token: {}&quot;</span>, e.<span class="fu">getMessage</span>());</a>
<a class="sourceLine" id="cb16-27" title="27">        }</a>
<a class="sourceLine" id="cb16-28" title="28">        <span class="kw">return</span> <span class="kw">false</span>;</a>
<a class="sourceLine" id="cb16-29" title="29">    }</a>
<a class="sourceLine" id="cb16-30" title="30">}</a></code></pre></div>
<h3 id="contrôleurs-rest">Contrôleurs REST</h3>
<h4 id="authcontroller---authentification">AuthController - Authentification</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb17-1" title="1"><span class="at">@RestController</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="at">@RequestMapping</span>(<span class="st">&quot;/api/auth&quot;</span>)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="at">@CrossOrigin</span>(origins = <span class="st">&quot;http://localhost:4200&quot;</span>)</a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw">public</span> <span class="kw">class</span> AuthController {</a>
<a class="sourceLine" id="cb17-5" title="5">    </a>
<a class="sourceLine" id="cb17-6" title="6">    <span class="at">@PostMapping</span>(<span class="st">&quot;/signin&quot;</span>)</a>
<a class="sourceLine" id="cb17-7" title="7">    <span class="kw">public</span> ResponseEntity&lt;?&gt; <span class="fu">authenticateUser</span>(<span class="at">@Valid</span> <span class="at">@RequestBody</span> LoginRequest loginRequest) {</a>
<a class="sourceLine" id="cb17-8" title="8">        Authentication authentication = authenticationManager.<span class="fu">authenticate</span>(</a>
<a class="sourceLine" id="cb17-9" title="9">            <span class="kw">new</span> <span class="fu">UsernamePasswordAuthenticationToken</span>(</a>
<a class="sourceLine" id="cb17-10" title="10">                loginRequest.<span class="fu">getEmail</span>(),</a>
<a class="sourceLine" id="cb17-11" title="11">                loginRequest.<span class="fu">getPassword</span>()</a>
<a class="sourceLine" id="cb17-12" title="12">            )</a>
<a class="sourceLine" id="cb17-13" title="13">        );</a>
<a class="sourceLine" id="cb17-14" title="14">        </a>
<a class="sourceLine" id="cb17-15" title="15">        SecurityContextHolder.<span class="fu">getContext</span>().<span class="fu">setAuthentication</span>(authentication);</a>
<a class="sourceLine" id="cb17-16" title="16">        <span class="bu">String</span> jwt = jwtUtils.<span class="fu">generateJwtToken</span>(authentication);</a>
<a class="sourceLine" id="cb17-17" title="17">        </a>
<a class="sourceLine" id="cb17-18" title="18">        UserDetailsImpl userDetails = (UserDetailsImpl) authentication.<span class="fu">getPrincipal</span>();</a>
<a class="sourceLine" id="cb17-19" title="19">        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; roles = userDetails.<span class="fu">getAuthorities</span>().<span class="fu">stream</span>()</a>
<a class="sourceLine" id="cb17-20" title="20">            .<span class="fu">map</span>(item -&gt; item.<span class="fu">getAuthority</span>())</a>
<a class="sourceLine" id="cb17-21" title="21">            .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</a>
<a class="sourceLine" id="cb17-22" title="22">        </a>
<a class="sourceLine" id="cb17-23" title="23">        <span class="kw">return</span> ResponseEntity.<span class="fu">ok</span>(<span class="kw">new</span> <span class="fu">JwtResponse</span>(jwt, userDetails.<span class="fu">getId</span>(),</a>
<a class="sourceLine" id="cb17-24" title="24">            userDetails.<span class="fu">getUsername</span>(), roles));</a>
<a class="sourceLine" id="cb17-25" title="25">    }</a>
<a class="sourceLine" id="cb17-26" title="26">    </a>
<a class="sourceLine" id="cb17-27" title="27">    <span class="at">@PostMapping</span>(<span class="st">&quot;/signup&quot;</span>)</a>
<a class="sourceLine" id="cb17-28" title="28">    <span class="kw">public</span> ResponseEntity&lt;?&gt; <span class="fu">registerUser</span>(<span class="at">@Valid</span> <span class="at">@RequestBody</span> SignupRequest signUpRequest) {</a>
<a class="sourceLine" id="cb17-29" title="29">        <span class="kw">if</span> (userRepository.<span class="fu">existsByEmail</span>(signUpRequest.<span class="fu">getEmail</span>())) {</a>
<a class="sourceLine" id="cb17-30" title="30">            <span class="kw">return</span> ResponseEntity.<span class="fu">badRequest</span>()</a>
<a class="sourceLine" id="cb17-31" title="31">                .<span class="fu">body</span>(<span class="kw">new</span> <span class="fu">MessageResponse</span>(<span class="st">&quot;Erreur: Email déjà utilisé!&quot;</span>));</a>
<a class="sourceLine" id="cb17-32" title="32">        }</a>
<a class="sourceLine" id="cb17-33" title="33">        </a>
<a class="sourceLine" id="cb17-34" title="34">        User user = <span class="kw">new</span> <span class="fu">User</span>();</a>
<a class="sourceLine" id="cb17-35" title="35">        user.<span class="fu">setEmail</span>(signUpRequest.<span class="fu">getEmail</span>());</a>
<a class="sourceLine" id="cb17-36" title="36">        user.<span class="fu">setPassword</span>(encoder.<span class="fu">encode</span>(signUpRequest.<span class="fu">getPassword</span>()));</a>
<a class="sourceLine" id="cb17-37" title="37">        user.<span class="fu">setNom</span>(signUpRequest.<span class="fu">getNom</span>());</a>
<a class="sourceLine" id="cb17-38" title="38">        user.<span class="fu">setPrenom</span>(signUpRequest.<span class="fu">getPrenom</span>());</a>
<a class="sourceLine" id="cb17-39" title="39">        </a>
<a class="sourceLine" id="cb17-40" title="40">        <span class="bu">Set</span>&lt;<span class="bu">Role</span>&gt; roles = <span class="kw">new</span> <span class="bu">HashSet</span>&lt;&gt;();</a>
<a class="sourceLine" id="cb17-41" title="41">        <span class="bu">Role</span> userRole = roleRepository.<span class="fu">findByName</span>(ERole.<span class="fu">ROLE_CITOYEN</span>)</a>
<a class="sourceLine" id="cb17-42" title="42">            .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Erreur: Rôle non trouvé.&quot;</span>));</a>
<a class="sourceLine" id="cb17-43" title="43">        roles.<span class="fu">add</span>(userRole);</a>
<a class="sourceLine" id="cb17-44" title="44">        user.<span class="fu">setRoles</span>(roles);</a>
<a class="sourceLine" id="cb17-45" title="45">        </a>
<a class="sourceLine" id="cb17-46" title="46">        userRepository.<span class="fu">save</span>(user);</a>
<a class="sourceLine" id="cb17-47" title="47">        </a>
<a class="sourceLine" id="cb17-48" title="48">        <span class="kw">return</span> ResponseEntity.<span class="fu">ok</span>(<span class="kw">new</span> <span class="fu">MessageResponse</span>(<span class="st">&quot;Utilisateur enregistré avec succès!&quot;</span>));</a>
<a class="sourceLine" id="cb17-49" title="49">    }</a>
<a class="sourceLine" id="cb17-50" title="50">}</a></code></pre></div>
<h4 id="ticketcontroller---gestion-des-tickets">TicketController - Gestion des Tickets</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb18-1" title="1"><span class="at">@RestController</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="at">@RequestMapping</span>(<span class="st">&quot;/api/tickets&quot;</span>)</a>
<a class="sourceLine" id="cb18-3" title="3"><span class="at">@CrossOrigin</span>(origins = <span class="st">&quot;http://localhost:4200&quot;</span>)</a>
<a class="sourceLine" id="cb18-4" title="4"><span class="kw">public</span> <span class="kw">class</span> TicketController {</a>
<a class="sourceLine" id="cb18-5" title="5">    </a>
<a class="sourceLine" id="cb18-6" title="6">    <span class="at">@PostMapping</span>(<span class="st">&quot;/create&quot;</span>)</a>
<a class="sourceLine" id="cb18-7" title="7">    <span class="kw">public</span> ResponseEntity&lt;?&gt; <span class="fu">createTicket</span>(<span class="at">@Valid</span> <span class="at">@RequestBody</span> TicketRequest ticketRequest,</a>
<a class="sourceLine" id="cb18-8" title="8">                                         Authentication authentication) {</a>
<a class="sourceLine" id="cb18-9" title="9">        UserDetailsImpl userDetails = (UserDetailsImpl) authentication.<span class="fu">getPrincipal</span>();</a>
<a class="sourceLine" id="cb18-10" title="10">        User user = userRepository.<span class="fu">findById</span>(userDetails.<span class="fu">getId</span>())</a>
<a class="sourceLine" id="cb18-11" title="11">            .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Utilisateur non trouvé&quot;</span>));</a>
<a class="sourceLine" id="cb18-12" title="12">        </a>
<a class="sourceLine" id="cb18-13" title="13">        Ticket ticket = ticketService.<span class="fu">createTicket</span>(ticketRequest, user);</a>
<a class="sourceLine" id="cb18-14" title="14">        </a>
<a class="sourceLine" id="cb18-15" title="15">        <span class="kw">return</span> ResponseEntity.<span class="fu">ok</span>(<span class="kw">new</span> <span class="fu">TicketResponse</span>(ticket));</a>
<a class="sourceLine" id="cb18-16" title="16">    }</a>
<a class="sourceLine" id="cb18-17" title="17">    </a>
<a class="sourceLine" id="cb18-18" title="18">    <span class="at">@GetMapping</span></a>
<a class="sourceLine" id="cb18-19" title="19">    <span class="kw">public</span> ResponseEntity&lt;<span class="bu">List</span>&lt;TicketResponse&gt;&gt; <span class="fu">getAllTickets</span>(Authentication authentication) {</a>
<a class="sourceLine" id="cb18-20" title="20">        UserDetailsImpl userDetails = (UserDetailsImpl) authentication.<span class="fu">getPrincipal</span>();</a>
<a class="sourceLine" id="cb18-21" title="21">        <span class="bu">List</span>&lt;Ticket&gt; tickets = ticketService.<span class="fu">getTicketsForUser</span>(userDetails.<span class="fu">getId</span>());</a>
<a class="sourceLine" id="cb18-22" title="22">        </a>
<a class="sourceLine" id="cb18-23" title="23">        <span class="bu">List</span>&lt;TicketResponse&gt; responses = tickets.<span class="fu">stream</span>()</a>
<a class="sourceLine" id="cb18-24" title="24">            .<span class="fu">map</span>(TicketResponse::<span class="kw">new</span>)</a>
<a class="sourceLine" id="cb18-25" title="25">            .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</a>
<a class="sourceLine" id="cb18-26" title="26">        </a>
<a class="sourceLine" id="cb18-27" title="27">        <span class="kw">return</span> ResponseEntity.<span class="fu">ok</span>(responses);</a>
<a class="sourceLine" id="cb18-28" title="28">    }</a>
<a class="sourceLine" id="cb18-29" title="29">    </a>
<a class="sourceLine" id="cb18-30" title="30">    <span class="at">@PutMapping</span>(<span class="st">&quot;/{id}/assign/{agentId}&quot;</span>)</a>
<a class="sourceLine" id="cb18-31" title="31">    <span class="at">@PreAuthorize</span>(<span class="st">&quot;hasRole(&#39;ADMIN_SUPPORT&#39;) or hasRole(&#39;AGENT_SUPPORT&#39;)&quot;</span>)</a>
<a class="sourceLine" id="cb18-32" title="32">    <span class="kw">public</span> ResponseEntity&lt;?&gt; <span class="fu">assignTicket</span>(<span class="at">@PathVariable</span> <span class="bu">Long</span> id,</a>
<a class="sourceLine" id="cb18-33" title="33">                                         <span class="at">@PathVariable</span> <span class="bu">Long</span> agentId) {</a>
<a class="sourceLine" id="cb18-34" title="34">        Ticket ticket = ticketService.<span class="fu">assignTicket</span>(id, agentId);</a>
<a class="sourceLine" id="cb18-35" title="35">        <span class="kw">return</span> ResponseEntity.<span class="fu">ok</span>(<span class="kw">new</span> <span class="fu">TicketResponse</span>(ticket));</a>
<a class="sourceLine" id="cb18-36" title="36">    }</a>
<a class="sourceLine" id="cb18-37" title="37">}</a></code></pre></div>
<h3 id="services-métier">Services Métier</h3>
<h4 id="ticketservice">TicketService</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb19-1" title="1"><span class="at">@Service</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="at">@Transactional</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">public</span> <span class="kw">class</span> TicketService {</a>
<a class="sourceLine" id="cb19-4" title="4">    </a>
<a class="sourceLine" id="cb19-5" title="5">    <span class="kw">public</span> Ticket <span class="fu">createTicket</span>(TicketRequest request, User createur) {</a>
<a class="sourceLine" id="cb19-6" title="6">        Ticket ticket = <span class="kw">new</span> <span class="fu">Ticket</span>();</a>
<a class="sourceLine" id="cb19-7" title="7">        ticket.<span class="fu">setNumeroTicket</span>(<span class="fu">generateTicketNumber</span>());</a>
<a class="sourceLine" id="cb19-8" title="8">        ticket.<span class="fu">setSujet</span>(request.<span class="fu">getSujet</span>());</a>
<a class="sourceLine" id="cb19-9" title="9">        ticket.<span class="fu">setDescription</span>(request.<span class="fu">getDescription</span>());</a>
<a class="sourceLine" id="cb19-10" title="10">        ticket.<span class="fu">setPriorite</span>(request.<span class="fu">getPriorite</span>());</a>
<a class="sourceLine" id="cb19-11" title="11">        ticket.<span class="fu">setStatut</span>(StatutTicket.<span class="fu">OUVERT</span>);</a>
<a class="sourceLine" id="cb19-12" title="12">        ticket.<span class="fu">setCreateur</span>(createur);</a>
<a class="sourceLine" id="cb19-13" title="13">        ticket.<span class="fu">setDateCreation</span>(LocalDateTime.<span class="fu">now</span>());</a>
<a class="sourceLine" id="cb19-14" title="14">        </a>
<a class="sourceLine" id="cb19-15" title="15">        Ticket savedTicket = ticketRepository.<span class="fu">save</span>(ticket);</a>
<a class="sourceLine" id="cb19-16" title="16">        </a>
<a class="sourceLine" id="cb19-17" title="17">        <span class="co">// Créer une entrée dans l&#39;historique</span></a>
<a class="sourceLine" id="cb19-18" title="18">        <span class="fu">createHistoryEntry</span>(savedTicket, <span class="st">&quot;CREATION&quot;</span>, <span class="st">&quot;Ticket créé&quot;</span>);</a>
<a class="sourceLine" id="cb19-19" title="19">        </a>
<a class="sourceLine" id="cb19-20" title="20">        <span class="kw">return</span> savedTicket;</a>
<a class="sourceLine" id="cb19-21" title="21">    }</a>
<a class="sourceLine" id="cb19-22" title="22">    </a>
<a class="sourceLine" id="cb19-23" title="23">    <span class="kw">public</span> Ticket <span class="fu">assignTicket</span>(<span class="bu">Long</span> ticketId, <span class="bu">Long</span> agentId) {</a>
<a class="sourceLine" id="cb19-24" title="24">        Ticket ticket = ticketRepository.<span class="fu">findById</span>(ticketId)</a>
<a class="sourceLine" id="cb19-25" title="25">            .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Ticket non trouvé&quot;</span>));</a>
<a class="sourceLine" id="cb19-26" title="26">        </a>
<a class="sourceLine" id="cb19-27" title="27">        User agent = userRepository.<span class="fu">findById</span>(agentId)</a>
<a class="sourceLine" id="cb19-28" title="28">            .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Agent non trouvé&quot;</span>));</a>
<a class="sourceLine" id="cb19-29" title="29">        </a>
<a class="sourceLine" id="cb19-30" title="30">        ticket.<span class="fu">setAssigneA</span>(agent);</a>
<a class="sourceLine" id="cb19-31" title="31">        </a>
<a class="sourceLine" id="cb19-32" title="32">        <span class="kw">if</span> (ticket.<span class="fu">getStatut</span>() == StatutTicket.<span class="fu">OUVERT</span>) {</a>
<a class="sourceLine" id="cb19-33" title="33">            ticket.<span class="fu">setStatut</span>(StatutTicket.<span class="fu">EN_COURS</span>);</a>
<a class="sourceLine" id="cb19-34" title="34">        }</a>
<a class="sourceLine" id="cb19-35" title="35">        </a>
<a class="sourceLine" id="cb19-36" title="36">        ticket.<span class="fu">setDateModification</span>(LocalDateTime.<span class="fu">now</span>());</a>
<a class="sourceLine" id="cb19-37" title="37">        </a>
<a class="sourceLine" id="cb19-38" title="38">        Ticket savedTicket = ticketRepository.<span class="fu">save</span>(ticket);</a>
<a class="sourceLine" id="cb19-39" title="39">        </a>
<a class="sourceLine" id="cb19-40" title="40">        <span class="co">// Historique et notification</span></a>
<a class="sourceLine" id="cb19-41" title="41">        <span class="fu">createHistoryEntry</span>(savedTicket, <span class="st">&quot;ASSIGNATION&quot;</span>,</a>
<a class="sourceLine" id="cb19-42" title="42">            <span class="st">&quot;Ticket assigné à &quot;</span> + agent.<span class="fu">getNom</span>() + <span class="st">&quot; &quot;</span> + agent.<span class="fu">getPrenom</span>());</a>
<a class="sourceLine" id="cb19-43" title="43">        </a>
<a class="sourceLine" id="cb19-44" title="44">        notificationService.<span class="fu">notifyTicketAssigned</span>(savedTicket, agent);</a>
<a class="sourceLine" id="cb19-45" title="45">        </a>
<a class="sourceLine" id="cb19-46" title="46">        <span class="kw">return</span> savedTicket;</a>
<a class="sourceLine" id="cb19-47" title="47">    }</a>
<a class="sourceLine" id="cb19-48" title="48">    </a>
<a class="sourceLine" id="cb19-49" title="49">    <span class="kw">private</span> <span class="bu">String</span> <span class="fu">generateTicketNumber</span>() {</a>
<a class="sourceLine" id="cb19-50" title="50">        <span class="kw">return</span> <span class="st">&quot;TKT-&quot;</span> + <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();</a>
<a class="sourceLine" id="cb19-51" title="51">    }</a>
<a class="sourceLine" id="cb19-52" title="52">    </a>
<a class="sourceLine" id="cb19-53" title="53">    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">createHistoryEntry</span>(Ticket ticket, <span class="bu">String</span> action, <span class="bu">String</span> description) {</a>
<a class="sourceLine" id="cb19-54" title="54">        TicketHistorique historique = <span class="kw">new</span> <span class="fu">TicketHistorique</span>();</a>
<a class="sourceLine" id="cb19-55" title="55">        historique.<span class="fu">setTicket</span>(ticket);</a>
<a class="sourceLine" id="cb19-56" title="56">        historique.<span class="fu">setAction</span>(action);</a>
<a class="sourceLine" id="cb19-57" title="57">        historique.<span class="fu">setDescription</span>(description);</a>
<a class="sourceLine" id="cb19-58" title="58">        historique.<span class="fu">setDateAction</span>(LocalDateTime.<span class="fu">now</span>());</a>
<a class="sourceLine" id="cb19-59" title="59">        ticketHistoriqueRepository.<span class="fu">save</span>(historique);</a>
<a class="sourceLine" id="cb19-60" title="60">    }</a>
<a class="sourceLine" id="cb19-61" title="61">}</a></code></pre></div>
<hr />
<h2 id="frontend---angular">Frontend - Angular</h2>
<h3 id="configuration-du-projet">Configuration du Projet</h3>
<p><strong>angular.json</strong> - Configuration principale</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb20-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="dt">&quot;projects&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb20-3" title="3">    <span class="dt">&quot;ticketing-frontend&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb20-4" title="4">      <span class="dt">&quot;architect&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb20-5" title="5">        <span class="dt">&quot;serve&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb20-6" title="6">          <span class="dt">&quot;options&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb20-7" title="7">            <span class="dt">&quot;proxyConfig&quot;</span><span class="fu">:</span> <span class="st">&quot;proxy.conf.json&quot;</span></a>
<a class="sourceLine" id="cb20-8" title="8">          <span class="fu">}</span></a>
<a class="sourceLine" id="cb20-9" title="9">        <span class="fu">}</span></a>
<a class="sourceLine" id="cb20-10" title="10">      <span class="fu">}</span></a>
<a class="sourceLine" id="cb20-11" title="11">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="fu">}</span></a></code></pre></div>
<p><strong>proxy.conf.json</strong> - Configuration du proxy pour éviter CORS</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb21-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="dt">&quot;/api&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb21-3" title="3">    <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="st">&quot;http://localhost:8080&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb21-4" title="4">    <span class="dt">&quot;secure&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb21-5" title="5">    <span class="dt">&quot;logLevel&quot;</span><span class="fu">:</span> <span class="st">&quot;debug&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb21-6" title="6">    <span class="dt">&quot;changeOrigin&quot;</span><span class="fu">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb21-7" title="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="fu">}</span></a></code></pre></div>
<h3 id="services-angular">Services Angular</h3>
<h4 id="authservice---gestion-de-lauthentification">AuthService - Gestion de l’authentification</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb22-1" title="1">@<span class="fu">Injectable</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  providedIn<span class="op">:</span> <span class="st">&#39;root&#39;</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb22-4" title="4"><span class="im">export</span> <span class="kw">class</span> AuthService <span class="op">{</span></a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="kw">private</span> apiUrl <span class="op">=</span> <span class="st">&#39;http://localhost:8080/api/auth&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-6" title="6">  <span class="kw">private</span> tokenKey <span class="op">=</span> <span class="st">&#39;auth-token&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-7" title="7">  <span class="kw">private</span> userKey <span class="op">=</span> <span class="st">&#39;auth-user&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9">  <span class="kw">constructor</span>(<span class="kw">private</span> http<span class="op">:</span> HttpClient) <span class="op">{</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb22-10" title="10"></a>
<a class="sourceLine" id="cb22-11" title="11">  <span class="fu">login</span>(email<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> password<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-12" title="12">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">post</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/signin`</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-13" title="13">      email<span class="op">,</span></a>
<a class="sourceLine" id="cb22-14" title="14">      password</a>
<a class="sourceLine" id="cb22-15" title="15">    <span class="op">}</span>).<span class="fu">pipe</span>(</a>
<a class="sourceLine" id="cb22-16" title="16">      <span class="fu">tap</span>((response<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-17" title="17">        <span class="fu">if</span> (<span class="va">response</span><span class="op">.</span><span class="at">token</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-18" title="18">          <span class="va">this</span><span class="op">.</span><span class="fu">saveToken</span>(<span class="va">response</span><span class="op">.</span><span class="at">token</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-19" title="19">          <span class="va">this</span><span class="op">.</span><span class="fu">saveUser</span>(response)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-20" title="20">        <span class="op">}</span></a>
<a class="sourceLine" id="cb22-21" title="21">      <span class="op">}</span>)</a>
<a class="sourceLine" id="cb22-22" title="22">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb22-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-24" title="24"></a>
<a class="sourceLine" id="cb22-25" title="25">  <span class="fu">signup</span>(userData<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-26" title="26">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">post</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/signup`</span><span class="op">,</span> userData)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-28" title="28"></a>
<a class="sourceLine" id="cb22-29" title="29">  <span class="fu">logout</span>()<span class="op">:</span> <span class="dt">void</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-30" title="30">    <span class="va">localStorage</span><span class="op">.</span><span class="fu">removeItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">tokenKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-31" title="31">    <span class="va">localStorage</span><span class="op">.</span><span class="fu">removeItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">userKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-32" title="32">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-33" title="33"></a>
<a class="sourceLine" id="cb22-34" title="34">  <span class="fu">getToken</span>()<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-35" title="35">    <span class="cf">return</span> <span class="va">localStorage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">tokenKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-36" title="36">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-37" title="37"></a>
<a class="sourceLine" id="cb22-38" title="38">  <span class="fu">isLoggedIn</span>()<span class="op">:</span> <span class="dt">boolean</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-39" title="39">    <span class="cf">return</span> <span class="op">!!</span><span class="va">this</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb22-40" title="40">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-41" title="41"></a>
<a class="sourceLine" id="cb22-42" title="42">  <span class="fu">getUserRoles</span>()<span class="op">:</span> <span class="dt">string</span><span class="op">[]</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-43" title="43">    <span class="kw">const</span> user <span class="op">=</span> <span class="va">this</span><span class="op">.</span><span class="fu">getUser</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb22-44" title="44">    <span class="cf">return</span> user <span class="op">?</span> <span class="va">user</span><span class="op">.</span><span class="at">roles</span> <span class="op">:</span> <span class="op">[];</span></a>
<a class="sourceLine" id="cb22-45" title="45">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-46" title="46"></a>
<a class="sourceLine" id="cb22-47" title="47">  <span class="fu">hasRole</span>(role<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">boolean</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-48" title="48">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="fu">getUserRoles</span>().<span class="fu">includes</span>(role)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-49" title="49">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-50" title="50"></a>
<a class="sourceLine" id="cb22-51" title="51">  <span class="kw">private</span> <span class="fu">saveToken</span>(token<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">void</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-52" title="52">    <span class="va">localStorage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">tokenKey</span><span class="op">,</span> token)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-53" title="53">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-54" title="54"></a>
<a class="sourceLine" id="cb22-55" title="55">  <span class="kw">private</span> <span class="fu">saveUser</span>(user<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="dt">void</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-56" title="56">    <span class="va">localStorage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">userKey</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(user))<span class="op">;</span></a>
<a class="sourceLine" id="cb22-57" title="57">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-58" title="58"></a>
<a class="sourceLine" id="cb22-59" title="59">  <span class="kw">private</span> <span class="fu">getUser</span>()<span class="op">:</span> <span class="dt">any</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-60" title="60">    <span class="kw">const</span> user <span class="op">=</span> <span class="va">localStorage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="va">this</span><span class="op">.</span><span class="at">userKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-61" title="61">    <span class="cf">return</span> user <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(user) <span class="op">:</span> <span class="dt">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-62" title="62">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-63" title="63"><span class="op">}</span></a></code></pre></div>
<h4 id="ticketservice---gestion-des-tickets">TicketService - Gestion des tickets</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb23-1" title="1">@<span class="fu">Injectable</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb23-2" title="2">  providedIn<span class="op">:</span> <span class="st">&#39;root&#39;</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb23-4" title="4"><span class="im">export</span> <span class="kw">class</span> TicketService <span class="op">{</span></a>
<a class="sourceLine" id="cb23-5" title="5">  <span class="kw">private</span> apiUrl <span class="op">=</span> <span class="st">&#39;http://localhost:8080/api/tickets&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-6" title="6"></a>
<a class="sourceLine" id="cb23-7" title="7">  <span class="kw">constructor</span>(<span class="kw">private</span> http<span class="op">:</span> HttpClient) <span class="op">{</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb23-8" title="8"></a>
<a class="sourceLine" id="cb23-9" title="9">  <span class="fu">createTicket</span>(ticketData<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb23-10" title="10">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">post</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/create`</span><span class="op">,</span> ticketData)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb23-12" title="12"></a>
<a class="sourceLine" id="cb23-13" title="13">  <span class="fu">getAllTickets</span>()<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">[]&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb23-14" title="14">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">get</span><span class="op">&lt;</span><span class="dt">any</span><span class="op">[]&gt;</span>(<span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-15" title="15">  <span class="op">}</span></a>
<a class="sourceLine" id="cb23-16" title="16"></a>
<a class="sourceLine" id="cb23-17" title="17">  <span class="fu">getTicketByNumber</span>(numero<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb23-18" title="18">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">get</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/numero/</span><span class="sc">${</span>numero<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb23-20" title="20"></a>
<a class="sourceLine" id="cb23-21" title="21">  <span class="fu">assignTicket</span>(ticketId<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> agentId<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb23-22" title="22">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">put</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>ticketId<span class="sc">}</span><span class="vs">/assign/</span><span class="sc">${</span>agentId<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb23-24" title="24"></a>
<a class="sourceLine" id="cb23-25" title="25">  <span class="fu">updateTicketStatus</span>(ticketId<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> status<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> Observable<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb23-26" title="26">    <span class="cf">return</span> <span class="va">this</span><span class="op">.</span><span class="va">http</span><span class="op">.</span><span class="fu">put</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>ticketId<span class="sc">}</span><span class="vs">/status`</span><span class="op">,</span> <span class="op">{</span> status <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb23-28" title="28"><span class="op">}</span></a></code></pre></div>
<h3 id="intercepteur-http---ajout-du-token-jwt">Intercepteur HTTP - Ajout du Token JWT</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb24-1" title="1">@<span class="fu">Injectable</span>()</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="im">export</span> <span class="kw">class</span> AuthInterceptor <span class="kw">implements</span> HttpInterceptor <span class="op">{</span></a>
<a class="sourceLine" id="cb24-3" title="3">  </a>
<a class="sourceLine" id="cb24-4" title="4">  <span class="kw">constructor</span>(<span class="kw">private</span> authService<span class="op">:</span> AuthService) <span class="op">{}</span></a>
<a class="sourceLine" id="cb24-5" title="5"></a>
<a class="sourceLine" id="cb24-6" title="6">  <span class="fu">intercept</span>(req<span class="op">:</span> HttpRequest<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;,</span> next<span class="op">:</span> HttpHandler)<span class="op">:</span> Observable<span class="op">&lt;</span>HttpEvent<span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb24-7" title="7">    <span class="kw">const</span> token <span class="op">=</span> <span class="va">this</span><span class="op">.</span><span class="va">authService</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb24-8" title="8">    </a>
<a class="sourceLine" id="cb24-9" title="9">    <span class="fu">if</span> (token) <span class="op">{</span></a>
<a class="sourceLine" id="cb24-10" title="10">      req <span class="op">=</span> <span class="va">req</span><span class="op">.</span><span class="fu">clone</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb24-11" title="11">        setHeaders<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb24-12" title="12">          Authorization<span class="op">:</span> <span class="vs">`Bearer </span><span class="sc">${</span>token<span class="sc">}</span><span class="vs">`</span></a>
<a class="sourceLine" id="cb24-13" title="13">        <span class="op">}</span></a>
<a class="sourceLine" id="cb24-14" title="14">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-15" title="15">    <span class="op">}</span></a>
<a class="sourceLine" id="cb24-16" title="16">    </a>
<a class="sourceLine" id="cb24-17" title="17">    <span class="cf">return</span> <span class="va">next</span><span class="op">.</span><span class="fu">handle</span>(req)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb24-19" title="19"><span class="op">}</span></a></code></pre></div>
<h3 id="guards---protection-des-routes">Guards - Protection des Routes</h3>
<h4 id="authguard---vérification-de-lauthentification">AuthGuard - Vérification de l’authentification</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb25-1" title="1"><span class="im">export</span> <span class="kw">const</span> authGuard<span class="op">:</span> CanActivateFn <span class="op">=</span> (route<span class="op">,</span> state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="kw">const</span> authService <span class="op">=</span> <span class="fu">inject</span>(AuthService)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-3" title="3">  <span class="kw">const</span> router <span class="op">=</span> <span class="fu">inject</span>(Router)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-4" title="4"></a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="fu">if</span> (<span class="va">authService</span><span class="op">.</span><span class="fu">isLoggedIn</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-6" title="6">    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb25-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb25-8" title="8"></a>
<a class="sourceLine" id="cb25-9" title="9">  <span class="va">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="op">[</span><span class="st">&#39;/login&#39;</span><span class="op">]</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-10" title="10">  <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb25-11" title="11"><span class="op">};</span></a></code></pre></div>
<h4 id="roleguard---vérification-des-rôles">RoleGuard - Vérification des rôles</h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb26-1" title="1"><span class="im">export</span> <span class="kw">function</span> <span class="fu">roleGuard</span>(allowedRoles<span class="op">:</span> <span class="dt">string</span><span class="op">[]</span>)<span class="op">:</span> CanActivateFn <span class="op">{</span></a>
<a class="sourceLine" id="cb26-2" title="2">  <span class="fu">return</span> (route<span class="op">,</span> state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb26-3" title="3">    <span class="kw">const</span> authService <span class="op">=</span> <span class="fu">inject</span>(AuthService)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-4" title="4">    <span class="kw">const</span> router <span class="op">=</span> <span class="fu">inject</span>(Router)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-5" title="5"></a>
<a class="sourceLine" id="cb26-6" title="6">    <span class="fu">if</span> (<span class="op">!</span><span class="va">authService</span><span class="op">.</span><span class="fu">isLoggedIn</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-7" title="7">      <span class="va">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="op">[</span><span class="st">&#39;/login&#39;</span><span class="op">]</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-8" title="8">      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-10" title="10"></a>
<a class="sourceLine" id="cb26-11" title="11">    <span class="kw">const</span> userRoles <span class="op">=</span> <span class="va">authService</span><span class="op">.</span><span class="fu">getUserRoles</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb26-12" title="12">    <span class="kw">const</span> hasRole <span class="op">=</span> <span class="va">allowedRoles</span><span class="op">.</span><span class="fu">some</span>(role <span class="kw">=&gt;</span> <span class="va">userRoles</span><span class="op">.</span><span class="fu">includes</span>(role))<span class="op">;</span></a>
<a class="sourceLine" id="cb26-13" title="13"></a>
<a class="sourceLine" id="cb26-14" title="14">    <span class="fu">if</span> (hasRole) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-15" title="15">      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-17" title="17"></a>
<a class="sourceLine" id="cb26-18" title="18">    <span class="va">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="op">[</span><span class="st">&#39;/dashboard&#39;</span><span class="op">]</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-19" title="19">    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-20" title="20">  <span class="op">};</span></a>
<a class="sourceLine" id="cb26-21" title="21"><span class="op">}</span></a></code></pre></div>
<h3 id="configuration-des-routes">Configuration des Routes</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb27-1" title="1"><span class="im">export</span> <span class="kw">const</span> routes<span class="op">:</span> Routes <span class="op">=</span> <span class="op">[</span></a>
<a class="sourceLine" id="cb27-2" title="2">  <span class="op">{</span> path<span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> redirectTo<span class="op">:</span> <span class="st">&#39;/login&#39;</span><span class="op">,</span> pathMatch<span class="op">:</span> <span class="st">&#39;full&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb27-3" title="3">  <span class="op">{</span> path<span class="op">:</span> <span class="st">&#39;login&#39;</span><span class="op">,</span> component<span class="op">:</span> LoginComponent <span class="op">},</span></a>
<a class="sourceLine" id="cb27-4" title="4">  <span class="op">{</span></a>
<a class="sourceLine" id="cb27-5" title="5">    path<span class="op">:</span> <span class="st">&#39;dashboard&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-6" title="6">    component<span class="op">:</span> DashboardComponent<span class="op">,</span></a>
<a class="sourceLine" id="cb27-7" title="7">    canActivate<span class="op">:</span> <span class="op">[</span>authGuard<span class="op">]</span></a>
<a class="sourceLine" id="cb27-8" title="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb27-9" title="9">  <span class="op">{</span></a>
<a class="sourceLine" id="cb27-10" title="10">    path<span class="op">:</span> <span class="st">&#39;admin/tickets&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-11" title="11">    loadComponent<span class="op">:</span> () <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;./components/admin-ticket-management/...&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb27-12" title="12">    canActivate<span class="op">:</span> <span class="op">[</span><span class="fu">roleGuard</span>(<span class="op">[</span><span class="st">&#39;ROLE_ADMIN_SUPPORT&#39;</span><span class="op">]</span>)<span class="op">]</span></a>
<a class="sourceLine" id="cb27-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb27-14" title="14"><span class="op">];</span></a></code></pre></div>
<h3 id="composants-principaux">Composants Principaux</h3>
<h4 id="logincomponent">LoginComponent</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode typescript"><code class="sourceCode typescript"><a class="sourceLine" id="cb28-1" title="1">@<span class="fu">Component</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb28-2" title="2">  selector<span class="op">:</span> <span class="st">&#39;app-login&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb28-3" title="3">  standalone<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb28-4" title="4">  imports<span class="op">:</span> <span class="op">[</span>CommonModule<span class="op">,</span> ReactiveFormsModule<span class="op">],</span></a>
<a class="sourceLine" id="cb28-5" title="5">  templateUrl<span class="op">:</span> <span class="st">&#39;./login.component.html&#39;</span></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb28-7" title="7"><span class="im">export</span> <span class="kw">class</span> LoginComponent <span class="op">{</span></a>
<a class="sourceLine" id="cb28-8" title="8">  loginForm<span class="op">:</span> FormGroup<span class="op">;</span></a>
<a class="sourceLine" id="cb28-9" title="9">  errorMessage <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb28-10" title="10"></a>
<a class="sourceLine" id="cb28-11" title="11">  <span class="kw">constructor</span>(</a>
<a class="sourceLine" id="cb28-12" title="12">    <span class="kw">private</span> fb<span class="op">:</span> FormBuilder<span class="op">,</span></a>
<a class="sourceLine" id="cb28-13" title="13">    <span class="kw">private</span> authService<span class="op">:</span> AuthService<span class="op">,</span></a>
<a class="sourceLine" id="cb28-14" title="14">    <span class="kw">private</span> router<span class="op">:</span> Router</a>
<a class="sourceLine" id="cb28-15" title="15">  ) <span class="op">{</span></a>
<a class="sourceLine" id="cb28-16" title="16">    <span class="va">this</span><span class="op">.</span><span class="at">loginForm</span> <span class="op">=</span> <span class="va">this</span><span class="op">.</span><span class="va">fb</span><span class="op">.</span><span class="fu">group</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb28-17" title="17">      email<span class="op">:</span> <span class="op">[</span><span class="st">&#39;&#39;</span><span class="op">,</span> <span class="op">[</span><span class="va">Validators</span><span class="op">.</span><span class="at">required</span><span class="op">,</span> <span class="va">Validators</span><span class="op">.</span><span class="at">email</span><span class="op">]],</span></a>
<a class="sourceLine" id="cb28-18" title="18">      password<span class="op">:</span> <span class="op">[</span><span class="st">&#39;&#39;</span><span class="op">,</span> <span class="va">Validators</span><span class="op">.</span><span class="at">required</span><span class="op">]</span></a>
<a class="sourceLine" id="cb28-19" title="19">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb28-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb28-21" title="21"></a>
<a class="sourceLine" id="cb28-22" title="22">  <span class="fu">onSubmit</span>()<span class="op">:</span> <span class="dt">void</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb28-23" title="23">    <span class="fu">if</span> (<span class="va">this</span><span class="op">.</span><span class="va">loginForm</span><span class="op">.</span><span class="at">valid</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb28-24" title="24">      <span class="kw">const</span> <span class="op">{</span> email<span class="op">,</span> password <span class="op">}</span> <span class="op">=</span> <span class="va">this</span><span class="op">.</span><span class="va">loginForm</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb28-25" title="25">      </a>
<a class="sourceLine" id="cb28-26" title="26">      <span class="va">this</span><span class="op">.</span><span class="va">authService</span><span class="op">.</span><span class="fu">login</span>(email<span class="op">,</span> password).<span class="fu">subscribe</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb28-27" title="27">        next<span class="op">:</span> (response) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb28-28" title="28">          <span class="va">this</span><span class="op">.</span><span class="va">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="op">[</span><span class="st">&#39;/dashboard&#39;</span><span class="op">]</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb28-29" title="29">        <span class="op">},</span></a>
<a class="sourceLine" id="cb28-30" title="30">        error<span class="op">:</span> (error) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb28-31" title="31">          <span class="va">this</span><span class="op">.</span><span class="at">errorMessage</span> <span class="op">=</span> <span class="st">&#39;Email ou mot de passe incorrect&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb28-32" title="32">        <span class="op">}</span></a>
<a class="sourceLine" id="cb28-33" title="33">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb28-34" title="34">    <span class="op">}</span></a>
<a class="sourceLine" id="cb28-35" title="35">  <span class="op">}</span></a>
<a class="sourceLine" id="cb28-36" title="36"><span class="op">}</span></a></code></pre></div>
<hr />
<h2 id="base-de-données---postgresql">Base de Données - PostgreSQL</h2>
<h3 id="schéma-complet">Schéma Complet</h3>
<h4 id="table-users">Table Users</h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</a>
<a class="sourceLine" id="cb29-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb29-3" title="3">    email <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb29-4" title="4">    <span class="kw">password</span> <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb29-5" title="5">    nom <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb29-6" title="6">    prenom <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb29-7" title="7">    telephone <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</a>
<a class="sourceLine" id="cb29-8" title="8">    date_creation <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span>,</a>
<a class="sourceLine" id="cb29-9" title="9">    actif <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">TRUE</span></a>
<a class="sourceLine" id="cb29-10" title="10">);</a></code></pre></div>
<h4 id="table-roles">Table Roles</h4>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">roles</span> (</a>
<a class="sourceLine" id="cb30-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb30-3" title="3">    name <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb30-4" title="4">    description <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</a>
<a class="sourceLine" id="cb30-5" title="5">);</a>
<a class="sourceLine" id="cb30-6" title="6"></a>
<a class="sourceLine" id="cb30-7" title="7"><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="kw">roles</span> (name, description) <span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb30-8" title="8">(<span class="st">&#39;ROLE_CITOYEN&#39;</span>, <span class="st">&#39;Utilisateur citoyen&#39;</span>),</a>
<a class="sourceLine" id="cb30-9" title="9">(<span class="st">&#39;ROLE_AGENT_SUPPORT&#39;</span>, <span class="st">&#39;Agent de support&#39;</span>),</a>
<a class="sourceLine" id="cb30-10" title="10">(<span class="st">&#39;ROLE_AGENT_TRAITEMENT&#39;</span>, <span class="st">&#39;Agent de traitement&#39;</span>),</a>
<a class="sourceLine" id="cb30-11" title="11">(<span class="st">&#39;ROLE_ADMIN_SUPPORT&#39;</span>, <span class="st">&#39;Administrateur support&#39;</span>);</a></code></pre></div>
<h4 id="table-user_roles-association">Table User_Roles (Association)</h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> user_roles (</a>
<a class="sourceLine" id="cb31-2" title="2">    user_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb31-3" title="3">    role_id BIGINT <span class="kw">REFERENCES</span> <span class="kw">roles</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb31-4" title="4">    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (user_id, role_id)</a>
<a class="sourceLine" id="cb31-5" title="5">);</a></code></pre></div>
<h4 id="table-tickets">Table Tickets</h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> tickets (</a>
<a class="sourceLine" id="cb32-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb32-3" title="3">    numero_ticket <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb32-4" title="4">    sujet <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb32-5" title="5">    description TEXT,</a>
<a class="sourceLine" id="cb32-6" title="6">    statut <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;OUVERT&#39;</span>,</a>
<a class="sourceLine" id="cb32-7" title="7">    priorite <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;MOYENNE&#39;</span>,</a>
<a class="sourceLine" id="cb32-8" title="8">    createur_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</a>
<a class="sourceLine" id="cb32-9" title="9">    assigne_a_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</a>
<a class="sourceLine" id="cb32-10" title="10">    date_creation <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span>,</a>
<a class="sourceLine" id="cb32-11" title="11">    date_modification <span class="dt">TIMESTAMP</span>,</a>
<a class="sourceLine" id="cb32-12" title="12">    date_cloture <span class="dt">TIMESTAMP</span></a>
<a class="sourceLine" id="cb32-13" title="13">);</a></code></pre></div>
<h4 id="table-commentaires">Table Commentaires</h4>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> commentaires (</a>
<a class="sourceLine" id="cb33-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb33-3" title="3">    ticket_id BIGINT <span class="kw">REFERENCES</span> tickets(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb33-4" title="4">    auteur_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</a>
<a class="sourceLine" id="cb33-5" title="5">    contenu TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb33-6" title="6">    date_creation <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span></a>
<a class="sourceLine" id="cb33-7" title="7">);</a></code></pre></div>
<h4 id="table-notifications">Table Notifications</h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> notifications (</a>
<a class="sourceLine" id="cb34-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb34-3" title="3">    destinataire_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb34-4" title="4">    ticket_id BIGINT <span class="kw">REFERENCES</span> tickets(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb34-5" title="5">    <span class="kw">type</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb34-6" title="6">    message TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb34-7" title="7">    lu <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</a>
<a class="sourceLine" id="cb34-8" title="8">    date_creation <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span></a>
<a class="sourceLine" id="cb34-9" title="9">);</a></code></pre></div>
<h4 id="table-ticket_historique">Table Ticket_Historique</h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> ticket_historique (</a>
<a class="sourceLine" id="cb35-2" title="2">    <span class="kw">id</span> BIGSERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb35-3" title="3">    ticket_id BIGINT <span class="kw">REFERENCES</span> tickets(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb35-4" title="4">    action <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb35-5" title="5">    description TEXT,</a>
<a class="sourceLine" id="cb35-6" title="6">    date_action <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span>,</a>
<a class="sourceLine" id="cb35-7" title="7">    auteur_id BIGINT <span class="kw">REFERENCES</span> users(<span class="kw">id</span>)</a>
<a class="sourceLine" id="cb35-8" title="8">);</a></code></pre></div>
<h3 id="index-pour-performance">Index pour Performance</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_tickets_numero <span class="kw">ON</span> tickets(numero_ticket);</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_tickets_statut <span class="kw">ON</span> tickets(statut);</a>
<a class="sourceLine" id="cb36-3" title="3"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_tickets_createur <span class="kw">ON</span> tickets(createur_id);</a>
<a class="sourceLine" id="cb36-4" title="4"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_tickets_assigne <span class="kw">ON</span> tickets(assigne_a_id);</a>
<a class="sourceLine" id="cb36-5" title="5"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_notifications_destinataire <span class="kw">ON</span> notifications(destinataire_id);</a>
<a class="sourceLine" id="cb36-6" title="6"><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_notifications_lu <span class="kw">ON</span> notifications(lu);</a></code></pre></div>
<hr />
<h2 id="fonctionnalités-principales">Fonctionnalités Principales</h2>
<h3 id="création-de-ticket-citoyen">1. Création de Ticket (Citoyen)</h3>
<p><strong>Workflow :</strong> 1. Citoyen se connecte 2. Remplit le formulaire de ticket (sujet, description, priorité) 3. Soumet le ticket 4. Reçoit un numéro de ticket unique 5. Peut suivre l’évolution du ticket</p>
<p><strong>Code Backend :</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">public</span> Ticket <span class="fu">createTicket</span>(TicketRequest request, User createur) {</a>
<a class="sourceLine" id="cb37-2" title="2">    <span class="bu">String</span> numeroTicket = <span class="st">&quot;TKT-&quot;</span> + <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();</a>
<a class="sourceLine" id="cb37-3" title="3">    </a>
<a class="sourceLine" id="cb37-4" title="4">    Ticket ticket = <span class="kw">new</span> <span class="fu">Ticket</span>();</a>
<a class="sourceLine" id="cb37-5" title="5">    ticket.<span class="fu">setNumeroTicket</span>(numeroTicket);</a>
<a class="sourceLine" id="cb37-6" title="6">    ticket.<span class="fu">setSujet</span>(request.<span class="fu">getSujet</span>());</a>
<a class="sourceLine" id="cb37-7" title="7">    ticket.<span class="fu">setDescription</span>(request.<span class="fu">getDescription</span>());</a>
<a class="sourceLine" id="cb37-8" title="8">    ticket.<span class="fu">setPriorite</span>(request.<span class="fu">getPriorite</span>());</a>
<a class="sourceLine" id="cb37-9" title="9">    ticket.<span class="fu">setStatut</span>(StatutTicket.<span class="fu">OUVERT</span>);</a>
<a class="sourceLine" id="cb37-10" title="10">    ticket.<span class="fu">setCreateur</span>(createur);</a>
<a class="sourceLine" id="cb37-11" title="11">    </a>
<a class="sourceLine" id="cb37-12" title="12">    <span class="kw">return</span> ticketRepository.<span class="fu">save</span>(ticket);</a>
<a class="sourceLine" id="cb37-13" title="13">}</a></code></pre></div>
<h3 id="assignation-de-ticket-admin">2. Assignation de Ticket (Admin)</h3>
<p><strong>Workflow :</strong> 1. Admin consulte la liste des tickets 2. Sélectionne un ticket non assigné 3. Choisit un agent disponible 4. Assigne le ticket 5. L’agent reçoit une notification</p>
<p><strong>Code Backend :</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">public</span> Ticket <span class="fu">assignTicket</span>(<span class="bu">Long</span> ticketId, <span class="bu">Long</span> agentId) {</a>
<a class="sourceLine" id="cb38-2" title="2">    Ticket ticket = ticketRepository.<span class="fu">findById</span>(ticketId)</a>
<a class="sourceLine" id="cb38-3" title="3">        .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Ticket non trouvé&quot;</span>));</a>
<a class="sourceLine" id="cb38-4" title="4">    </a>
<a class="sourceLine" id="cb38-5" title="5">    User agent = userRepository.<span class="fu">findById</span>(agentId)</a>
<a class="sourceLine" id="cb38-6" title="6">        .<span class="fu">orElseThrow</span>(() -&gt; <span class="kw">new</span> <span class="bu">RuntimeException</span>(<span class="st">&quot;Agent non trouvé&quot;</span>));</a>
<a class="sourceLine" id="cb38-7" title="7">    </a>
<a class="sourceLine" id="cb38-8" title="8">    ticket.<span class="fu">setAssigneA</span>(agent);</a>
<a class="sourceLine" id="cb38-9" title="9">    ticket.<span class="fu">setStatut</span>(StatutTicket.<span class="fu">EN_COURS</span>);</a>
<a class="sourceLine" id="cb38-10" title="10">    </a>
<a class="sourceLine" id="cb38-11" title="11">    <span class="co">// Enregistrer l&#39;historique</span></a>
<a class="sourceLine" id="cb38-12" title="12">    <span class="fu">createHistoryEntry</span>(ticket, <span class="st">&quot;ASSIGNATION&quot;</span>, </a>
<a class="sourceLine" id="cb38-13" title="13">        <span class="st">&quot;Assigné à &quot;</span> + agent.<span class="fu">getNom</span>());</a>
<a class="sourceLine" id="cb38-14" title="14">    </a>
<a class="sourceLine" id="cb38-15" title="15">    <span class="co">// Envoyer notification</span></a>
<a class="sourceLine" id="cb38-16" title="16">    notificationService.<span class="fu">notifyTicketAssigned</span>(ticket, agent);</a>
<a class="sourceLine" id="cb38-17" title="17">    </a>
<a class="sourceLine" id="cb38-18" title="18">    <span class="kw">return</span> ticketRepository.<span class="fu">save</span>(ticket);</a>
<a class="sourceLine" id="cb38-19" title="19">}</a></code></pre></div>
<h3 id="suivi-de-ticket-citoyen">3. Suivi de Ticket (Citoyen)</h3>
<p><strong>Workflow :</strong> 1. Citoyen entre le numéro de ticket 2. Consulte le statut actuel 3. Voit l’historique des actions 4. Ajoute des commentaires si nécessaire</p>
<h3 id="traitement-de-ticket-agent">4. Traitement de Ticket (Agent)</h3>
<p><strong>Workflow :</strong> 1. Agent voit ses tickets assignés 2. Change le statut (EN_COURS, RESOLU, CLOS) 3. Ajoute des commentaires 4. Met à jour la priorité si nécessaire</p>
<h3 id="gestion-des-utilisateurs-admin">5. Gestion des Utilisateurs (Admin)</h3>
<p><strong>Workflow :</strong> 1. Admin consulte la liste des utilisateurs 2. Peut créer de nouveaux agents 3. Assigne les rôles appropriés 4. Active/Désactive des comptes</p>
<hr />
<h2 id="sécurité-et-authentification">Sécurité et Authentification</h2>
<h3 id="authentification-jwt">Authentification JWT</h3>
<h4 id="processus-de-login">Processus de Login</h4>
<pre><code>1. User → POST /api/auth/signin {email, password}
2. Backend → Valide credentials
3. Backend → Génère JWT token
4. Backend → Response {token, user info, roles}
5. Frontend → Stocke token dans localStorage
6. Frontend → Ajoute token à chaque requête HTTP (Header: Authorization: Bearer &lt;token&gt;)</code></pre>
<h4 id="structure-du-token-jwt">Structure du Token JWT</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb40-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb40-2" title="2">  <span class="dt">&quot;header&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb40-3" title="3">    <span class="dt">&quot;alg&quot;</span><span class="fu">:</span> <span class="st">&quot;HS512&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb40-4" title="4">    <span class="dt">&quot;typ&quot;</span><span class="fu">:</span> <span class="st">&quot;JWT&quot;</span></a>
<a class="sourceLine" id="cb40-5" title="5">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb40-6" title="6">  <span class="dt">&quot;payload&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb40-7" title="7">    <span class="dt">&quot;sub&quot;</span><span class="fu">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb40-8" title="8">    <span class="dt">&quot;iat&quot;</span><span class="fu">:</span> <span class="dv">1700000000</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb40-9" title="9">    <span class="dt">&quot;exp&quot;</span><span class="fu">:</span> <span class="dv">1700086400</span></a>
<a class="sourceLine" id="cb40-10" title="10">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb40-11" title="11">  <span class="dt">&quot;signature&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span></a>
<a class="sourceLine" id="cb40-12" title="12"><span class="fu">}</span></a></code></pre></div>
<h3 id="hachage-des-mots-de-passe">Hachage des Mots de Passe</h3>
<p>Utilisation de <strong>BCrypt</strong> avec Spring Security :</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb41-1" title="1"><span class="at">@Bean</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw">public</span> PasswordEncoder <span class="fu">passwordEncoder</span>() {</a>
<a class="sourceLine" id="cb41-3" title="3">    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">BCryptPasswordEncoder</span>();</a>
<a class="sourceLine" id="cb41-4" title="4">}</a>
<a class="sourceLine" id="cb41-5" title="5"></a>
<a class="sourceLine" id="cb41-6" title="6"><span class="co">// Lors de la création d&#39;un utilisateur</span></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="bu">String</span> hashedPassword = passwordEncoder.<span class="fu">encode</span>(plainPassword);</a>
<a class="sourceLine" id="cb41-8" title="8">user.<span class="fu">setPassword</span>(hashedPassword);</a></code></pre></div>
<h3 id="protection-csrf-et-cors">Protection CSRF et CORS</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb42-1" title="1"><span class="co">// Configuration CORS</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="at">@Bean</span></a>
<a class="sourceLine" id="cb42-3" title="3"><span class="kw">public</span> CorsConfigurationSource <span class="fu">corsConfigurationSource</span>() {</a>
<a class="sourceLine" id="cb42-4" title="4">    CorsConfiguration configuration = <span class="kw">new</span> <span class="fu">CorsConfiguration</span>();</a>
<a class="sourceLine" id="cb42-5" title="5">    configuration.<span class="fu">setAllowedOrigins</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;http://localhost:4200&quot;</span>));</a>
<a class="sourceLine" id="cb42-6" title="6">    configuration.<span class="fu">setAllowedMethods</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;GET&quot;</span>, <span class="st">&quot;POST&quot;</span>, <span class="st">&quot;PUT&quot;</span>, <span class="st">&quot;DELETE&quot;</span>));</a>
<a class="sourceLine" id="cb42-7" title="7">    configuration.<span class="fu">setAllowedHeaders</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;*&quot;</span>));</a>
<a class="sourceLine" id="cb42-8" title="8">    configuration.<span class="fu">setAllowCredentials</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb42-9" title="9">    </a>
<a class="sourceLine" id="cb42-10" title="10">    UrlBasedCorsConfigurationSource source = <span class="kw">new</span> <span class="fu">UrlBasedCorsConfigurationSource</span>();</a>
<a class="sourceLine" id="cb42-11" title="11">    source.<span class="fu">registerCorsConfiguration</span>(<span class="st">&quot;/**&quot;</span>, configuration);</a>
<a class="sourceLine" id="cb42-12" title="12">    <span class="kw">return</span> source;</a>
<a class="sourceLine" id="cb42-13" title="13">}</a>
<a class="sourceLine" id="cb42-14" title="14"></a>
<a class="sourceLine" id="cb42-15" title="15"><span class="co">// Désactivation CSRF (API REST stateless)</span></a>
<a class="sourceLine" id="cb42-16" title="16">http.<span class="fu">csrf</span>(csrf -&gt; csrf.<span class="fu">disable</span>())</a></code></pre></div>
<h3 id="autorisation-basée-sur-les-rôles">Autorisation basée sur les Rôles</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb43-1" title="1"><span class="co">// Au niveau des méthodes</span></a>
<a class="sourceLine" id="cb43-2" title="2"><span class="at">@PreAuthorize</span>(<span class="st">&quot;hasRole(&#39;ADMIN_SUPPORT&#39;)&quot;</span>)</a>
<a class="sourceLine" id="cb43-3" title="3"><span class="kw">public</span> <span class="bu">List</span>&lt;User&gt; <span class="fu">getAllAgents</span>() {</a>
<a class="sourceLine" id="cb43-4" title="4">    <span class="kw">return</span> userRepository.<span class="fu">findByRoles</span>();</a>
<a class="sourceLine" id="cb43-5" title="5">}</a>
<a class="sourceLine" id="cb43-6" title="6"></a>
<a class="sourceLine" id="cb43-7" title="7"><span class="co">// Au niveau des routes</span></a>
<a class="sourceLine" id="cb43-8" title="8">.<span class="fu">requestMatchers</span>(<span class="st">&quot;/api/admin/**&quot;</span>).<span class="fu">hasRole</span>(<span class="st">&quot;ADMIN_SUPPORT&quot;</span>)</a></code></pre></div>
<hr />
<h2 id="tests-et-documentation-api">Tests et Documentation API</h2>
<h3 id="swaggeropenapi">Swagger/OpenAPI</h3>
<h4 id="configuration">Configuration</h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb44-1" title="1"><span class="at">@Configuration</span></a>
<a class="sourceLine" id="cb44-2" title="2"><span class="kw">public</span> <span class="kw">class</span> OpenApiConfig {</a>
<a class="sourceLine" id="cb44-3" title="3">    </a>
<a class="sourceLine" id="cb44-4" title="4">    <span class="at">@Bean</span></a>
<a class="sourceLine" id="cb44-5" title="5">    <span class="kw">public</span> OpenAPI <span class="fu">customOpenAPI</span>() {</a>
<a class="sourceLine" id="cb44-6" title="6">        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">OpenAPI</span>()</a>
<a class="sourceLine" id="cb44-7" title="7">            .<span class="fu">info</span>(<span class="kw">new</span> <span class="fu">Info</span>()</a>
<a class="sourceLine" id="cb44-8" title="8">                .<span class="fu">title</span>(<span class="st">&quot;API Système de Gestion des Tickets&quot;</span>)</a>
<a class="sourceLine" id="cb44-9" title="9">                .<span class="fu">version</span>(<span class="st">&quot;1.0.0&quot;</span>)</a>
<a class="sourceLine" id="cb44-10" title="10">                .<span class="fu">description</span>(<span class="st">&quot;Documentation de l&#39;API REST&quot;</span>))</a>
<a class="sourceLine" id="cb44-11" title="11">            .<span class="fu">components</span>(<span class="kw">new</span> <span class="fu">Components</span>()</a>
<a class="sourceLine" id="cb44-12" title="12">                .<span class="fu">addSecuritySchemes</span>(<span class="st">&quot;bearer-jwt&quot;</span>, <span class="kw">new</span> <span class="fu">SecurityScheme</span>()</a>
<a class="sourceLine" id="cb44-13" title="13">                    .<span class="fu">type</span>(SecurityScheme.<span class="fu">Type</span>.<span class="fu">HTTP</span>)</a>
<a class="sourceLine" id="cb44-14" title="14">                    .<span class="fu">scheme</span>(<span class="st">&quot;bearer&quot;</span>)</a>
<a class="sourceLine" id="cb44-15" title="15">                    .<span class="fu">bearerFormat</span>(<span class="st">&quot;JWT&quot;</span>)))</a>
<a class="sourceLine" id="cb44-16" title="16">            .<span class="fu">addSecurityItem</span>(<span class="kw">new</span> <span class="fu">SecurityRequirement</span>()</a>
<a class="sourceLine" id="cb44-17" title="17">                .<span class="fu">addList</span>(<span class="st">&quot;bearer-jwt&quot;</span>));</a>
<a class="sourceLine" id="cb44-18" title="18">    }</a>
<a class="sourceLine" id="cb44-19" title="19">}</a></code></pre></div>
<h4 id="accès-à-swagger-ui">Accès à Swagger UI</h4>
<pre><code>URL: http://localhost:8080/swagger-ui/index.html</code></pre>
<h4 id="utilisation-de-swagger">Utilisation de Swagger</h4>
<ol type="1">
<li><strong>Se connecter</strong> :
<ul>
<li>Utilisez <code>/api/auth/signin</code></li>
<li>Copiez le token reçu</li>
</ul></li>
<li><strong>Autoriser</strong> :
<ul>
<li>Cliquez sur “Authorize” 🔓</li>
<li>Collez le token JWT</li>
<li>Cliquez sur “Authorize”</li>
</ul></li>
<li><strong>Tester les endpoints</strong> :
<ul>
<li>Tous les endpoints sont maintenant accessibles</li>
<li>Cliquez sur “Try it out”</li>
<li>Remplissez les paramètres</li>
<li>Cliquez sur “Execute”</li>
</ul></li>
</ol>
<h3 id="tests-manuels-avec-postman">Tests Manuels avec Postman</h3>
<p><strong>Collection de tests disponible dans</strong> : <code>API_TESTS.http</code></p>
<p>Exemple :</p>
<pre class="http"><code>### 1. Login Admin
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  &quot;email&quot;: &quot;admin@justice.com&quot;,
  &quot;password&quot;: &quot;Admin@123&quot;
}

### 2. Créer un Ticket
POST http://localhost:8080/api/tickets/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  &quot;sujet&quot;: &quot;Problème technique&quot;,
  &quot;description&quot;: &quot;Description détaillée&quot;,
  &quot;priorite&quot;: &quot;HAUTE&quot;
}

### 3. Lister tous les Tickets
GET http://localhost:8080/api/tickets
Authorization: Bearer {{token}}</code></pre>
<hr />
<h2 id="gestion-des-backups">Gestion des Backups</h2>
<h3 id="scripts-de-backup-automatique">Scripts de Backup Automatique</h3>
<h4 id="script-backup.sh">Script backup.sh</h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb47-2" title="2"></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="va">DB_NAME=</span><span class="st">&quot;ticketing_db&quot;</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="va">DB_USER=</span><span class="st">&quot;postgres&quot;</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="va">DB_PASSWORD=</span><span class="st">&quot;postgres&quot;</span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="va">BACKUP_DIR=</span><span class="st">&quot;./backups&quot;</span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="va">DATE=$(</span><span class="fu">date</span> +%Y%m%d_%H%M%S<span class="va">)</span></a>
<a class="sourceLine" id="cb47-8" title="8"></a>
<a class="sourceLine" id="cb47-9" title="9"><span class="fu">mkdir</span> -p <span class="st">&quot;</span><span class="va">$BACKUP_DIR</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb47-10" title="10"></a>
<a class="sourceLine" id="cb47-11" title="11"><span class="co"># Backup SQL</span></a>
<a class="sourceLine" id="cb47-12" title="12"><span class="bu">echo</span> <span class="st">&quot;🔄 Création du backup SQL...&quot;</span></a>
<a class="sourceLine" id="cb47-13" title="13"><span class="va">PGPASSWORD=$DB_PASSWORD</span> <span class="ex">pg_dump</span> -U <span class="va">$DB_USER</span> -h localhost \</a>
<a class="sourceLine" id="cb47-14" title="14">  <span class="va">$DB_NAME</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$BACKUP_DIR</span><span class="st">/ticketing_db_backup_</span><span class="va">$DATE</span><span class="st">.sql&quot;</span></a>
<a class="sourceLine" id="cb47-15" title="15"></a>
<a class="sourceLine" id="cb47-16" title="16"><span class="co"># Backup compressé</span></a>
<a class="sourceLine" id="cb47-17" title="17"><span class="bu">echo</span> <span class="st">&quot;📦 Création du backup compressé...&quot;</span></a>
<a class="sourceLine" id="cb47-18" title="18"><span class="va">PGPASSWORD=$DB_PASSWORD</span> <span class="ex">pg_dump</span> -U <span class="va">$DB_USER</span> -h localhost \</a>
<a class="sourceLine" id="cb47-19" title="19">  -Fc <span class="va">$DB_NAME</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$BACKUP_DIR</span><span class="st">/ticketing_db_backup_</span><span class="va">$DATE</span><span class="st">.dump&quot;</span></a>
<a class="sourceLine" id="cb47-20" title="20"></a>
<a class="sourceLine" id="cb47-21" title="21"><span class="co"># Nettoyer les backups &gt; 7 jours</span></a>
<a class="sourceLine" id="cb47-22" title="22"><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$BACKUP_DIR</span><span class="st">&quot;</span> -name <span class="st">&quot;ticketing_db_backup_*.sql&quot;</span> -mtime +7 -delete</a>
<a class="sourceLine" id="cb47-23" title="23"><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$BACKUP_DIR</span><span class="st">&quot;</span> -name <span class="st">&quot;ticketing_db_backup_*.dump&quot;</span> -mtime +7 -delete</a>
<a class="sourceLine" id="cb47-24" title="24"></a>
<a class="sourceLine" id="cb47-25" title="25"><span class="bu">echo</span> <span class="st">&quot;✅ Backup terminé !&quot;</span></a></code></pre></div>
<h3 id="utilisation-des-backups">Utilisation des Backups</h3>
<h4 id="créer-un-backup">Créer un Backup</h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># Via script</span></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="ex">./backups/backup.sh</span></a>
<a class="sourceLine" id="cb48-3" title="3"></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="co"># Manuellement</span></a>
<a class="sourceLine" id="cb48-5" title="5"><span class="va">PGPASSWORD=</span>postgres <span class="ex">pg_dump</span> -U postgres -h localhost \</a>
<a class="sourceLine" id="cb48-6" title="6">  ticketing_db <span class="op">&gt;</span> backup.sql</a></code></pre></div>
<h4 id="restaurer-un-backup">Restaurer un Backup</h4>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb49-1" title="1"><span class="co"># Via script</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="ex">./backups/restore.sh</span> backups/ticketing_db_backup_20251122.sql</a>
<a class="sourceLine" id="cb49-3" title="3"></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="co"># Manuellement</span></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="va">PGPASSWORD=</span>postgres <span class="ex">psql</span> -U postgres -h localhost \</a>
<a class="sourceLine" id="cb49-6" title="6">  -d ticketing_db <span class="op">&lt;</span> backup.sql</a></code></pre></div>
<h4 id="backup-via-dbeaver">Backup via DBeaver</h4>
<ol type="1">
<li>Clic droit sur <code>ticketing_db</code></li>
<li><strong>Tools</strong> → <strong>Dump database</strong></li>
<li>Choisir le format : <strong>Custom</strong> (recommandé)</li>
<li>Sélectionner toutes les tables</li>
<li>Cliquer sur <strong>Start</strong></li>
</ol>
<hr />
<h2 id="déploiement">Déploiement</h2>
<h3 id="compilation-et-build">Compilation et Build</h3>
<h4 id="backend-1">Backend</h4>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb50-1" title="1"><span class="bu">cd</span> ticketing-backend</a>
<a class="sourceLine" id="cb50-2" title="2"></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="co"># Compiler le projet</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="ex">mvn</span> clean package -DskipTests</a>
<a class="sourceLine" id="cb50-5" title="5"></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="co"># Le fichier JAR sera créé dans target/</span></a>
<a class="sourceLine" id="cb50-7" title="7"><span class="co"># ticketing-backend-1.0.0.jar</span></a></code></pre></div>
<h4 id="frontend-1">Frontend</h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb51-1" title="1"><span class="bu">cd</span> ticketing-frontend</a>
<a class="sourceLine" id="cb51-2" title="2"></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="co"># Build de production</span></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="ex">ng</span> build --configuration production</a>
<a class="sourceLine" id="cb51-5" title="5"></a>
<a class="sourceLine" id="cb51-6" title="6"><span class="co"># Les fichiers seront dans dist/ticketing-frontend/</span></a></code></pre></div>
<h3 id="démarrage-de-lapplication">Démarrage de l’Application</h3>
<h4 id="démarrer-postgresql">Démarrer PostgreSQL</h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb52-1" title="1"><span class="fu">sudo</span> systemctl start postgresql</a>
<a class="sourceLine" id="cb52-2" title="2"><span class="fu">sudo</span> systemctl status postgresql</a></code></pre></div>
<h4 id="démarrer-le-backend">Démarrer le Backend</h4>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb53-1" title="1"><span class="bu">cd</span> ticketing-backend</a>
<a class="sourceLine" id="cb53-2" title="2"></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="co"># Mode développement avec logs</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="va">SPRING_DATASOURCE_PASSWORD=</span>postgres <span class="kw">\</span></a>
<a class="sourceLine" id="cb53-5" title="5">  <span class="ex">java</span> -jar target/ticketing-backend-1.0.0.jar</a>
<a class="sourceLine" id="cb53-6" title="6"></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="co"># Mode production en arrière-plan</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="va">SPRING_DATASOURCE_PASSWORD=</span>postgres <span class="kw">\</span></a>
<a class="sourceLine" id="cb53-9" title="9">  <span class="fu">nohup</span> java -jar target/ticketing-backend-1.0.0.jar <span class="op">&gt;</span> backend.log <span class="op">2&gt;&amp;1</span> <span class="kw">&amp;</span></a></code></pre></div>
<h4 id="démarrer-le-frontend">Démarrer le Frontend</h4>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb54-1" title="1"><span class="bu">cd</span> ticketing-frontend</a>
<a class="sourceLine" id="cb54-2" title="2"></a>
<a class="sourceLine" id="cb54-3" title="3"><span class="co"># Mode développement</span></a>
<a class="sourceLine" id="cb54-4" title="4"><span class="ex">npm</span> start</a>
<a class="sourceLine" id="cb54-5" title="5"></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="co"># En arrière-plan</span></a>
<a class="sourceLine" id="cb54-7" title="7"><span class="ex">npm</span> start <span class="op">&gt;</span> frontend.log <span class="op">2&gt;&amp;1</span> <span class="kw">&amp;</span></a></code></pre></div>
<h3 id="vérification-du-déploiement">Vérification du Déploiement</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb55-1" title="1"><span class="co"># Vérifier le backend</span></a>
<a class="sourceLine" id="cb55-2" title="2"><span class="ex">curl</span> http://localhost:8080/api/auth/signin</a>
<a class="sourceLine" id="cb55-3" title="3"></a>
<a class="sourceLine" id="cb55-4" title="4"><span class="co"># Vérifier le frontend</span></a>
<a class="sourceLine" id="cb55-5" title="5"><span class="ex">curl</span> http://localhost:4200</a>
<a class="sourceLine" id="cb55-6" title="6"></a>
<a class="sourceLine" id="cb55-7" title="7"><span class="co"># Vérifier les processus</span></a>
<a class="sourceLine" id="cb55-8" title="8"><span class="fu">ps</span> aux <span class="kw">|</span> <span class="fu">grep</span> java</a>
<a class="sourceLine" id="cb55-9" title="9"><span class="fu">ps</span> aux <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;ng serve&quot;</span></a></code></pre></div>
<h3 id="variables-denvironnement">Variables d’Environnement</h3>
<p>Pour la production, utilisez des variables d’environnement :</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># Backend</span></a>
<a class="sourceLine" id="cb56-2" title="2"><span class="bu">export</span> <span class="va">SPRING_DATASOURCE_URL=</span>jdbc:postgresql://localhost:5432/ticketing_db</a>
<a class="sourceLine" id="cb56-3" title="3"><span class="bu">export</span> <span class="va">SPRING_DATASOURCE_PASSWORD=</span>your_secure_password</a>
<a class="sourceLine" id="cb56-4" title="4"><span class="bu">export</span> <span class="va">JWT_SECRET=</span>your_base64_encoded_secret</a>
<a class="sourceLine" id="cb56-5" title="5"><span class="bu">export</span> <span class="va">JWT_EXPIRATION=</span>86400000</a>
<a class="sourceLine" id="cb56-6" title="6"></a>
<a class="sourceLine" id="cb56-7" title="7"><span class="co"># Démarrer</span></a>
<a class="sourceLine" id="cb56-8" title="8"><span class="ex">java</span> -jar ticketing-backend-1.0.0.jar</a></code></pre></div>
<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="problèmes-courants">Problèmes Courants</h3>
<h4 id="erreur-de-connexion-à-la-base-de-données">1. Erreur de connexion à la base de données</h4>
<p><strong>Symptôme :</strong></p>
<pre><code>org.postgresql.util.PSQLException: Connection refused</code></pre>
<p><strong>Solutions :</strong></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb58-1" title="1"><span class="co"># Vérifier que PostgreSQL est démarré</span></a>
<a class="sourceLine" id="cb58-2" title="2"><span class="fu">sudo</span> systemctl status postgresql</a>
<a class="sourceLine" id="cb58-3" title="3"><span class="fu">sudo</span> systemctl start postgresql</a>
<a class="sourceLine" id="cb58-4" title="4"></a>
<a class="sourceLine" id="cb58-5" title="5"><span class="co"># Vérifier les credentials dans application.properties</span></a>
<a class="sourceLine" id="cb58-6" title="6"><span class="co"># Tester la connexion manuellement</span></a>
<a class="sourceLine" id="cb58-7" title="7"><span class="ex">psql</span> -U postgres -h localhost -d ticketing_db</a></code></pre></div>
<h4 id="cors-error-dans-le-navigateur">2. CORS Error dans le navigateur</h4>
<p><strong>Symptôme :</strong></p>
<pre><code>Access to XMLHttpRequest has been blocked by CORS policy</code></pre>
<p><strong>Solutions :</strong> - Vérifier que le proxy est configuré (<code>proxy.conf.json</code>) - Vérifier la configuration CORS dans <code>SecurityConfig.java</code> - Redémarrer le frontend : <code>npm start</code></p>
<h4 id="token-jwt-invalide-ou-expiré">3. Token JWT invalide ou expiré</h4>
<p><strong>Symptôme :</strong></p>
<pre><code>401 Unauthorized - Invalid JWT token</code></pre>
<p><strong>Solutions :</strong> - Se reconnecter pour obtenir un nouveau token - Vérifier que la clé secrète JWT est correcte - Augmenter la durée d’expiration si nécessaire</p>
<h4 id="port-déjà-utilisé">4. Port déjà utilisé</h4>
<p><strong>Symptôme :</strong></p>
<pre><code>Port 8080 is already in use</code></pre>
<p><strong>Solutions :</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb62-1" title="1"><span class="co"># Trouver le processus utilisant le port</span></a>
<a class="sourceLine" id="cb62-2" title="2"><span class="ex">lsof</span> -i :8080</a>
<a class="sourceLine" id="cb62-3" title="3"></a>
<a class="sourceLine" id="cb62-4" title="4"><span class="co"># Tuer le processus</span></a>
<a class="sourceLine" id="cb62-5" title="5"><span class="bu">kill</span> -9 <span class="op">&lt;</span>PID<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb62-6" title="6"></a>
<a class="sourceLine" id="cb62-7" title="7"><span class="co"># Ou utiliser pkill</span></a>
<a class="sourceLine" id="cb62-8" title="8"><span class="ex">pkill</span> -f <span class="st">&quot;java -jar.*ticketing&quot;</span></a></code></pre></div>
<h4 id="compilation-typescript-échoue">5. Compilation TypeScript échoue</h4>
<p><strong>Symptôme :</strong></p>
<pre><code>Object is possibly &#39;undefined&#39;</code></pre>
<p><strong>Solutions :</strong> - Utiliser l’opérateur de chaînage optionnel : <code>object?.property</code> - Vérifier les types dans les interfaces TypeScript - Ajouter des vérifications null : <code>if (object) { ... }</code></p>
<h3 id="logs-et-débogage">Logs et Débogage</h3>
<h4 id="consulter-les-logs-backend">Consulter les logs Backend</h4>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb64-1" title="1"><span class="co"># Logs en temps réel</span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="fu">tail</span> -f ticketing-backend/backend.log</a>
<a class="sourceLine" id="cb64-3" title="3"></a>
<a class="sourceLine" id="cb64-4" title="4"><span class="co"># Rechercher des erreurs</span></a>
<a class="sourceLine" id="cb64-5" title="5"><span class="fu">grep</span> -i <span class="st">&quot;error&quot;</span> ticketing-backend/backend.log</a>
<a class="sourceLine" id="cb64-6" title="6"></a>
<a class="sourceLine" id="cb64-7" title="7"><span class="co"># Voir les requêtes SQL</span></a>
<a class="sourceLine" id="cb64-8" title="8"><span class="fu">grep</span> -i <span class="st">&quot;hibernate&quot;</span> ticketing-backend/backend.log</a></code></pre></div>
<h4 id="consulter-les-logs-frontend">Consulter les logs Frontend</h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb65-1" title="1"><span class="co"># Logs en temps réel</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="fu">tail</span> -f ticketing-frontend/frontend.log</a>
<a class="sourceLine" id="cb65-3" title="3"></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co"># Console du navigateur</span></a>
<a class="sourceLine" id="cb65-5" title="5"><span class="co"># F12 → Console (Chrome/Firefox)</span></a></code></pre></div>
<h4 id="activer-les-logs-de-débogage">Activer les logs de débogage</h4>
<p>Dans <code>application-dev.properties</code> :</p>
<pre class="properties"><code>logging.level.com.justice.ticketing=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE</code></pre>
<h3 id="commandes-utiles">Commandes Utiles</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb67-1" title="1"><span class="co"># Vérifier les services en cours</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="fu">ps</span> aux <span class="kw">|</span> <span class="fu">grep</span> -E <span class="st">&quot;(java|ng serve|postgres)&quot;</span></a>
<a class="sourceLine" id="cb67-3" title="3"></a>
<a class="sourceLine" id="cb67-4" title="4"><span class="co"># Arrêter tous les services</span></a>
<a class="sourceLine" id="cb67-5" title="5"><span class="ex">pkill</span> -f <span class="st">&quot;java -jar.*ticketing&quot;</span></a>
<a class="sourceLine" id="cb67-6" title="6"><span class="ex">pkill</span> -f <span class="st">&quot;ng serve&quot;</span></a>
<a class="sourceLine" id="cb67-7" title="7"></a>
<a class="sourceLine" id="cb67-8" title="8"><span class="co"># Nettoyer et rebuilder le backend</span></a>
<a class="sourceLine" id="cb67-9" title="9"><span class="bu">cd</span> ticketing-backend</a>
<a class="sourceLine" id="cb67-10" title="10"><span class="ex">mvn</span> clean install -DskipTests</a>
<a class="sourceLine" id="cb67-11" title="11"></a>
<a class="sourceLine" id="cb67-12" title="12"><span class="co"># Nettoyer et rebuilder le frontend</span></a>
<a class="sourceLine" id="cb67-13" title="13"><span class="bu">cd</span> ticketing-frontend</a>
<a class="sourceLine" id="cb67-14" title="14"><span class="fu">rm</span> -rf node_modules dist</a>
<a class="sourceLine" id="cb67-15" title="15"><span class="ex">npm</span> install</a>
<a class="sourceLine" id="cb67-16" title="16"><span class="ex">ng</span> build</a>
<a class="sourceLine" id="cb67-17" title="17"></a>
<a class="sourceLine" id="cb67-18" title="18"><span class="co"># Vérifier les ports ouverts</span></a>
<a class="sourceLine" id="cb67-19" title="19"><span class="fu">netstat</span> -tlnp <span class="kw">|</span> <span class="fu">grep</span> -E <span class="st">&quot;(8080|4200|5432)&quot;</span></a>
<a class="sourceLine" id="cb67-20" title="20"></a>
<a class="sourceLine" id="cb67-21" title="21"><span class="co"># Tester la connectivité base de données</span></a>
<a class="sourceLine" id="cb67-22" title="22"><span class="ex">psql</span> -U postgres -h localhost -d ticketing_db -c <span class="st">&quot;SELECT version();&quot;</span></a></code></pre></div>
<hr />
<h2 id="comptes-de-test">Comptes de Test</h2>
<h3 id="utilisateurs-préconfigurés">Utilisateurs Préconfigurés</h3>
<table>
<thead>
<tr class="header">
<th>Email</th>
<th>Mot de passe</th>
<th>Rôle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>admin@justice.com</td>
<td>Admin@123</td>
<td>ADMIN_SUPPORT</td>
</tr>
<tr class="even">
<td>agent1@justice.gov</td>
<td>Agent@123</td>
<td>AGENT_SUPPORT</td>
</tr>
<tr class="odd">
<td>agent2@justice.gov</td>
<td>Agent@123</td>
<td>AGENT_SUPPORT</td>
</tr>
<tr class="even">
<td>test@test.com</td>
<td>Test@123</td>
<td>CITOYEN</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ressources-et-documentation">Ressources et Documentation</h2>
<h3 id="documentation-officielle">Documentation Officielle</h3>
<ul>
<li><strong>Spring Boot</strong> : https://spring.io/projects/spring-boot</li>
<li><strong>Spring Security</strong> : https://spring.io/projects/spring-security</li>
<li><strong>Angular</strong> : https://angular.io/docs</li>
<li><strong>PostgreSQL</strong> : https://www.postgresql.org/docs/</li>
<li><strong>JWT</strong> : https://jwt.io/</li>
</ul>
<h3 id="outils-utilisés">Outils Utilisés</h3>
<ul>
<li><strong>DBeaver</strong> : https://dbeaver.io/</li>
<li><strong>Swagger</strong> : https://swagger.io/</li>
<li><strong>Postman</strong> : https://www.postman.com/</li>
</ul>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>Ce guide couvre l’ensemble du développement du système de gestion des tickets, de l’installation initiale au déploiement final.</p>
<h3 id="points-clés-à-retenir">Points Clés à Retenir</h3>
<ol type="1">
<li><strong>Architecture 3-tiers</strong> : Séparation claire entre présentation, métier et données</li>
<li><strong>Sécurité JWT</strong> : Authentification et autorisation robustes</li>
<li><strong>RESTful API</strong> : Communication standardisée entre frontend et backend</li>
<li><strong>Documentation</strong> : Swagger pour tester et documenter l’API</li>
<li><strong>Backups</strong> : Scripts automatiques pour la sauvegarde des données</li>
</ol>
<h3 id="prochaines-étapes">Prochaines Étapes</h3>
<ul>
<li>Implémenter des tests unitaires et d’intégration</li>
<li>Ajouter la fonctionnalité d’envoi d’emails</li>
<li>Créer un tableau de bord avec statistiques</li>
<li>Implémenter la recherche avancée de tickets</li>
<li>Ajouter le support multi-langues</li>
</ul>
<h3 id="support">Support</h3>
<p>Pour toute question ou problème, consultez la documentation ou créez une issue sur le dépôt GitHub.</p>
<hr />
<p><strong>Date de création</strong> : Novembre 2025<br />
<strong>Auteur</strong> : Équipe de Développement - Ministère de la Justice<br />
<strong>Version</strong> : 1.0.0</p>
</body>
</html>
